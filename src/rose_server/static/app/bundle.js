(()=>{var G=()=>({disabled:!1,label:"Ask",async ask(){let e=this.$el.closest("form")?.querySelector('[name="q"]:not([disabled])')?.value?.trim()||"";if(!(!e||this.disabled)){this.disabled=!0;try{let r=this.$el.closest("form")?.querySelector('select[name="lens_id"]')?.value?.trim()||"",i=await(await fetch("/v1/ask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e,lens_id:r||void 0})})).json();if(!i?.thread_id)throw new Error("Missing thread_id");let l=r?`?lens_id=${encodeURIComponent(r)}`:"";window.location.href="/v1/threads/"+i.thread_id+l}catch(t){alert("Error: "+(t?.message||String(t)))}finally{this.disabled=!1}}}});var X=()=>({uuid:null,accepted:!1,collapsed:!1,expanded:!1,editing:!1,draft:"",original:"",editable:!1,saving:!1,init(){this.uuid=this.$el.dataset.uuid,this.accepted=this.$el.classList.contains("accepted");let e=this.$refs?.sourceContent;this.editable=!!e;let t=this.$el.querySelector(".message-content");if(t&&!this.editable){let r=t.textContent?.trim()||"";t.innerHTML=this.$markdown(r)}if(!this.editable)return;let n=e.content?.textContent;this.original=(n??t?.innerText??"").trimEnd(),this.draft=this.original},startEdit(){this.editable&&(this.editing=!0,this.draft=this.original,this.$nextTick(()=>this.$refs?.editor?.focus()))},cancelEdit(){this.editable&&(this.editing=!1,this.draft=this.original)},async saveEdit(){if(!(!this.editable||this.saving)){this.saving=!0;try{let e=await fetch(`/v1/messages/${this.uuid}/revisions`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({content:this.draft})});if(!e.ok)throw new Error(`HTTP ${e.status}`);window.location.reload()}catch(e){console.error("Error:",e),this.saving=!1}}},async toggleAccepted(){try{let e=await fetch(`/v1/messages/${this.uuid}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({accepted:!this.accepted})});if(!e.ok)throw new Error(`HTTP ${e.status}`);this.accepted=!this.accepted}catch(e){console.error("Error:",e)}}});function _(e){let t=[];for(let n of e)if(n.type==="text")if(t.length>0&&t[t.length-1].type==="text"){let r=t[t.length-1];r.value+=n.value}else t.push({type:"text",value:n.value});else t.push(n);return(t.length===0||t[t.length-1].type!=="text")&&t.push({type:"text",value:""}),t}function H(e){let t=[];for(let n of e)n.type==="text"&&n.value&&t.push(n.value);return t.join("")}function D(e,t=[]){let n=[];for(let r of t)n.push({type:"lens",lensId:r.lensId,atName:r.atName});return e&&n.push({type:"text",value:e}),_(n)}function I(e,t){let n=Math.max(0,Math.min(t.tokenIndex,e.length-1)),r=e[n],s=r.type==="text"?r.value.length:0,i=Math.max(0,Math.min(t.offset,s));return{tokenIndex:n,offset:i}}function V(e,t){let{tokens:n,caret:r}=e;if(t.type==="insertText"){let{at:s,text:i}=t,l=[...n],p=l[s.tokenIndex];if(p.type!=="text")throw new Error("Cannot insert text into non-text token");let u=p.value.slice(0,s.offset),a=p.value.slice(s.offset);l[s.tokenIndex]={type:"text",value:u+i+a};let o=_(l),m={tokenIndex:s.tokenIndex,offset:s.offset+i.length},h=I(o,m),g={type:"deleteRange",from:s,to:{tokenIndex:s.tokenIndex,offset:s.offset+i.length}};return{buffer:{tokens:o,caret:h},inverse:g}}if(t.type==="deleteRange"){let{from:s,to:i}=t,l=[...n],p=[];if(s.tokenIndex===i.tokenIndex){let c=l[s.tokenIndex];if(c.type!=="text")throw new Error("Cannot delete from non-text token");let d=c.value.slice(0,s.offset),x=c.value.slice(s.offset,i.offset),k=c.value.slice(i.offset);l[s.tokenIndex]={type:"text",value:d+k};let $=_(l),w={tokenIndex:s.tokenIndex,offset:s.offset},q=I($,w);return{buffer:{tokens:$,caret:q},inverse:{type:"insertText",at:s,text:x}}}let u=l[s.tokenIndex],a=l[i.tokenIndex];if(u.type!=="text"||a.type!=="text")throw new Error("Cross-token delete requires text tokens at boundaries");let o=u.value.slice(0,s.offset),m=u.value.slice(s.offset),h=a.value.slice(0,i.offset),g=a.value.slice(i.offset);for(let c=s.tokenIndex;c<=i.tokenIndex;c++)p.push(l[c]);p[0]={type:"text",value:m},p[p.length-1]={type:"text",value:h};let v=[];for(let c=0;c<p.length;c++){let d=p[c];if(d.type==="text")if(v.length>0&&v[v.length-1].type==="text"){let x=v[v.length-1];v[v.length-1]={type:"text",value:x.value+d.value}}else v.push(d);else v.push(d)}for(let c=i.tokenIndex;c>=s.tokenIndex;c--)l.splice(c,1);l.splice(s.tokenIndex,0,{type:"text",value:o+g});let y=_(l),b={tokenIndex:s.tokenIndex,offset:s.offset},E=I(y,b);return{buffer:{tokens:y,caret:E},inverse:{type:"insertTokens",at:s,tokens:v}}}if(t.type==="replaceToken"){let{index:s,token:i}=t,l=[...n],p=l[s];l[s]=i;let u=_(l),a=I(u,r);return{buffer:{tokens:u,caret:a},inverse:{type:"replaceToken",index:s,token:p}}}if(t.type==="insertTokens"){let{at:s,tokens:i}=t,l=[...n],p=l[s.tokenIndex];if(p.type!=="text")throw new Error("Cannot insert tokens into non-text token");let u=p.value.slice(0,s.offset),a=p.value.slice(s.offset),o=[...i];if(o.length>0){let f=o[0];f.type==="text"?o[0]={type:"text",value:u+f.value}:u&&o.unshift({type:"text",value:u});let c=o[o.length-1];c.type==="text"?o[o.length-1]={type:"text",value:c.value+a}:a&&o.push({type:"text",value:a})}else o.push({type:"text",value:u+a});l.splice(s.tokenIndex,1,...o);let m=_(l),h=i[i.length-1],g=0,v=0;if(h&&h.type!=="text"){let f=0;for(let w=0;w<s.tokenIndex;w++){let q=n[w];q.type==="text"&&(f+=q.value.length)}f+=s.offset;let c=f;for(let w of i)w.type==="text"&&(c+=w.value.length);let d=0;for(let w of i)w.type!=="text"&&d++;let x=0,k=0,$=!1;for(let w=0;w<m.length;w++){let q=m[w];if(q.type==="text"){if(!$&&x>=f&&($=!0),c<=x+q.value.length){g=w,v=c-x;break}x+=q.value.length}else if($&&(k++,k===d)){g=w+1,v=0;break}}}else{let f=u.length;for(let d of i)d.type==="text"&&(f+=d.value.length);let c=0;for(let d=0;d<m.length;d++){let x=m[d];if(x.type==="text"){if(f<=c+x.value.length){g=d,v=f-c;break}c+=x.value.length}}}let b=I(m,{tokenIndex:g,offset:v});return{buffer:{tokens:m,caret:b},inverse:{type:"deleteRange",from:s,to:b}}}throw new Error(`Unknown op type: ${t.type}`)}function M(e){let t=document.createElement("div");return t.textContent=e||"",t.textContent||""}function U(e,t){t.textContent="";let n=new Map,r=0;for(let s=0;s<e.length;s++){let i=e[s];if(i.type==="lens"){let l=document.createElement("span");l.setAttribute("x-data",`lensToken('${i.lensId}', '${i.atName}')`),l.setAttribute("x-on:click","removeLens()"),l.setAttribute("data-token","lens"),t.appendChild(l),n.set(s,{node:l,textStart:r,textEnd:r})}else if(i.type==="text"){let l=document.createTextNode(M(i.value));t.appendChild(l),n.set(s,{node:l,textStart:r,textEnd:r+i.value.length}),r+=i.value.length}}return n}function W(e,t,n){let r=t.get(e.tokenIndex);if(!r)return null;if(r.node.nodeType===Node.TEXT_NODE)return{node:r.node,offset:e.offset};if(e.offset===0)return{node:n,offset:Array.from(n.childNodes).indexOf(r.node)};let s=e.tokenIndex+1,i=t.get(s);return i?{node:n,offset:Array.from(n.childNodes).indexOf(i.node)}:{node:n,offset:n.childNodes.length}}function R(e,t,n,r){for(let[s,i]of n.entries())if(i.node===e)return e.nodeType===Node.TEXT_NODE?{tokenIndex:s,offset:Math.min(t,i.textEnd-i.textStart)}:{tokenIndex:s,offset:0};if(e===r){let s=Array.from(r.childNodes);if(t>=s.length){let l=n.size-1,p=n.get(l);return p&&p.node.nodeType===Node.TEXT_NODE?{tokenIndex:l,offset:p.textEnd-p.textStart}:{tokenIndex:l,offset:0}}let i=s[t];for(let[l,p]of n.entries())if(p.node===i)return{tokenIndex:l,offset:0}}return{tokenIndex:n.size-1,offset:0}}var de=/(?:^|[^A-Za-z0-9-])@([A-Za-z0-9-]*)/g;function Z(e,t){let n="",r=[],s=0,i=-1;for(let h=0;h<e.length;h++){let g=e[h];if(g.type==="text"){let v=n.length;n+=g.value,r.push({tokenIndex:h,startChar:v,endChar:n.length}),h<t.tokenIndex?s+=g.value.length:h===t.tokenIndex&&(s+=t.offset,i=r.length-1)}else r.push({tokenIndex:h,startChar:n.length,endChar:n.length}),h<t.tokenIndex&&(i=r.length-1)}if(i===-1||n.length===0)return null;let l=n.slice(0,s),p=Array.from(l.matchAll(de));if(p.length===0)return null;let u=p[p.length-1],a=u[0].startsWith("@")?0:1,o=u.index+a,m=o+u[0].length-a;if(m!==s)return null;for(let h of r)if(o>=h.startChar&&o<h.endChar)return m>h.endChar?null:{tokenIndex:h.tokenIndex,startOffset:o-h.startChar,endOffset:m-h.startChar,query:u[1].toLowerCase(),raw:u[0].slice(a)};return null}function K(e){let t=e,n={tokens:D(""),caret:{tokenIndex:0,offset:0}},r=null,s=!1,i=()=>{if(!t||!r||document.activeElement!==t)return;let a=W(n.caret,r,t);if(!a)return;let o=window.getSelection();if(!o)return;let m=document.createRange();m.setStart(a.node,a.offset),m.collapse(!0),o.removeAllRanges(),o.addRange(m)},l=()=>{if(!t||!r)return;let a=window.getSelection();if(!a||!a.rangeCount)return;let o=a.getRangeAt(0);n.caret=R(o.startContainer,o.startOffset,r,t)},p=()=>{if(!t)return;let a=[],o=new Map,m=0,h=0,g=!1;for(let f of t.childNodes){if(f.nodeType===Node.ELEMENT_NODE&&f.dataset?.token==="lens"){a.push({type:"lens",lensId:f.dataset.lensId,atName:f.dataset.atName}),o.set(h++,{node:f,textStart:m,textEnd:m});continue}if(f.nodeType===Node.TEXT_NODE){let c=f.textContent||"";a.push({type:"text",value:c}),o.set(h++,{node:f,textStart:m,textEnd:m+c.length}),m+=c.length;continue}f.nodeType===Node.ELEMENT_NODE&&f.tagName==="BR"&&(g=!0)}let v=a.some((f,c)=>f.type==="text"&&c>0&&a[c-1].type==="text"),y=a.length>0&&a[a.length-1].type==="lens";(v||y||g)&&(g=!0);let b=n.caret,E=window.getSelection();if(E&&E.rangeCount){let f=E.getRangeAt(0);b=R(f.startContainer,f.startOffset,o,t)}if(g){let f=_(a);b=I(f,b),n={tokens:f,caret:b},u()}else{let f=_(a);b=I(f,b),n={tokens:f,caret:b},r=o}},u=()=>{if(!(!t||s)){s=!0;try{r=U(n.tokens,t),i(),window.Alpine&&window.Alpine.initTree(t)}finally{s=!1}}};return{getBuffer(){return n},setBuffer(a){n=a,u()},loadFromQuery(a,o){let m=[];o?.lensId&&o?.atName&&m.push({lensId:o.lensId,atName:o.atName});let h=D(a,m),g=h.length-1,v=h[g];n={tokens:h,caret:{tokenIndex:g,offset:v?.type==="text"?v.value.length:0}},u()},syncFromDOM(){p()},syncBufferOnly(){if(!t)return;let a=[],o=new Map,m=0,h=0;for(let f of t.childNodes)if(f.nodeType===Node.ELEMENT_NODE&&f.dataset?.token==="lens")a.push({type:"lens",lensId:f.dataset.lensId,atName:f.dataset.atName}),o.set(h++,{node:f,textStart:m,textEnd:m});else if(f.nodeType===Node.TEXT_NODE){let c=f.textContent||"";a.push({type:"text",value:c}),o.set(h++,{node:f,textStart:m,textEnd:m+c.length}),m+=c.length}a.length===0&&(a.push({type:"text",value:""}),o.set(0,{node:null,textStart:0,textEnd:0}));let g=window.getSelection(),v={tokenIndex:0,offset:0};if(g&&g.rangeCount){let f=g.getRangeAt(0);v=R(f.startContainer,f.startOffset,o,t)}let y=a.length-1;v.tokenIndex=Math.max(0,Math.min(v.tokenIndex,y));let b=a[v.tokenIndex],E=b?.type==="text"?b.value.length:0;v.offset=Math.max(0,Math.min(v.offset,E)),n={tokens:a,caret:v},r=o},serialize(){return H(n.tokens)},detectMention(){return Z(n.tokens,n.caret)},insertLensToken(a,o,m){if(!t)return;let h=window.getSelection();if(!h||!h.rangeCount)return;let g=r.get(a.tokenIndex);if(!g||!g.node)return;let v=g.node,y=v.textContent||"",b=y.slice(0,a.startOffset),E=y.slice(a.endOffset),f=document.createElement("span");f.setAttribute("x-data",`lensToken('${o}', '${m}')`),f.setAttribute("x-on:click","removeLens()"),f.setAttribute("data-token","lens");let c=v.parentNode;if(!c)return;if(b){let k=document.createTextNode(b);c.insertBefore(k,v)}if(c.insertBefore(f,v),E){let k=document.createTextNode(E);c.insertBefore(k,v)}else{let k=document.createTextNode(" ");c.insertBefore(k,v)}c.removeChild(v),window.Alpine&&window.Alpine.initTree(f);let d=document.createRange(),x=f.nextSibling;x&&x.nodeType===Node.TEXT_NODE&&(d.setStart(x,0),d.collapse(!0),h.removeAllRanges(),h.addRange(d)),this.syncBufferOnly()},applyOperation(a){l();let o=V(n,a);return n=o.buffer,u(),o.inverse},removeLens(a){if(!t)return;let o=t.querySelector(`[data-token="lens"][data-lens-id="${a}"]`);!o||!o.parentNode||(o.parentNode.removeChild(o),this.syncBufferOnly())},placeCaretAtEnd(){if(!t)return;let a=window.getSelection();if(!a)return;let o=t.lastChild;if(!o)return;let m=document.createRange();o.nodeType===Node.TEXT_NODE?m.setStart(o,o.textContent?.length||0):m.setStartAfter(o),m.collapse(!0),a.removeAllRanges(),a.addRange(m),this.syncBufferOnly()},onInput(a){t&&t.addEventListener("input",()=>{l(),a()})},destroy(){r=null}}}var Q=()=>({queryValue:"",settingsOpen:!1,submitting:!1,mentionOpen:!1,mentionIndex:0,mentionQuery:"",mentionOptions:[],lensOptions:[],idToAtName:{},errorMessage:"",controller:null,showError(e){this.errorMessage=e,setTimeout(()=>this.errorMessage="",5e3)},init(){let e=this.$store.search.query||"",t=this.$store.search.lens_map||{};this.queryValue=e.replace(/^@\S+\s*/,""),this.buildLensState(t),this.controller=K(this.$refs?.editor),this.$watch("queryValue",n=>{this.$store.search.query=n}),this.$watch("$store.search.lens_id",(n,r)=>{let s=this.$refs?.lensSelect;s&&(s.value=n),r!==void 0&&this.controller.removeLens(r),this.syncFromStore(),r!==void 0&&this.controller&&document.activeElement===this.$refs?.editor&&this.controller.placeCaretAtEnd()}),this.$nextTick(()=>{this.syncFromStore(),e||this.$refs?.editor?.focus()})},syncFromStore(){if(!this.controller)return;this.controller.loadFromQuery(this.queryValue,this.getSelectedLens());let e=this.$refs?.textarea;e&&(e.value=this.queryValue)},syncToStore(){if(!this.controller)throw new Error("Buffer controller not initialized");this.controller.syncBufferOnly();let e=this.controller.serialize();if(e!==this.queryValue){this.queryValue=e;let t=this.$refs?.textarea;t&&(t.value=e)}this.updateMentionState()},updateMentionState(){if(!this.controller)return;let e=this.controller.detectMention();if(!e){this.mentionOpen=!1,this.mentionQuery="",this.mentionOptions=this.lensOptions,this.mentionIndex=0;return}let t=e.query,n=this.lensOptions.filter(s=>s.atName.startsWith(t)),r=this.mentionOpen&&this.mentionQuery===t;this.mentionOpen=n.length>0,this.mentionQuery=t,this.mentionOptions=n,this.mentionIndex=r?Math.min(this.mentionIndex,Math.max(n.length-1,0)):0},buildLensState(e){let t=Object.entries(e).map(([r,s])=>({lensId:s,atName:r.toLowerCase()})).filter(r=>r.atName),n=Object.fromEntries(Object.entries(e).map(([r,s])=>[s,r]));this.lensOptions=t,this.mentionOptions=t,this.idToAtName=n},getSelectedLens(){let e=this.$store.search.lens_id||"";if(!e)return null;let t=this.idToAtName[e]||"";return{lensId:e,atName:t}},selectMention(){if(!this.controller||!this.mentionOpen||!this.mentionOptions.length)return;let e=this.controller.detectMention();if(!e)return;let t=this.mentionOptions[this.mentionIndex];t&&(this.controller.insertLensToken(e,t.lensId,t.atName),this.$store.search.lens_id=t.lensId,this.queryValue=this.controller.serialize(),this.mentionOpen=!1,this.mentionQuery="",this.mentionOptions=this.lensOptions,this.mentionIndex=0)},handleEditorKeydown(e){if(!this.mentionOpen){e.key==="Enter"&&(e.preventDefault(),this.submit());return}if(e.key==="ArrowDown"){e.preventDefault();let t=Math.max(this.mentionOptions.length-1,0);this.mentionIndex=Math.min(this.mentionIndex+1,t);return}if(e.key==="ArrowUp"){e.preventDefault(),this.mentionIndex=Math.max(this.mentionIndex-1,0);return}if(e.key==="Enter"||e.key===" "){e.preventDefault(),this.selectMention();return}e.key==="Escape"&&(e.preventDefault(),this.mentionOpen=!1,this.mentionQuery="",this.mentionOptions=this.lensOptions,this.mentionIndex=0)},async submit(){if(this.submitting)return;let e=this.$refs?.form;if(!e)throw new Error("Form ref not found");this.submitting=!0;try{let n=this.$refs?.lensSelect?.value?.trim()||this.$store.search.lens_id||"",r=this.queryValue.trim(),s=Number(this.$store.search.limit);if(!s||s<1)throw new Error("Invalid search limit");let i={q:r,exact:!!this.$store.search.exact,limit:s,lens_id:n||void 0},l=await fetch("/v1/search/fragment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error(`Search failed (HTTP ${l.status})`);let p=await l.text(),u=document.querySelector("#search-root");if(!u)throw new Error("Page missing #search-root element");u.outerHTML=p;let a=new URLSearchParams;i.q&&a.set("q",i.q),i.exact&&a.set("exact","true"),i.limit&&a.set("limit",String(i.limit)),i.lens_id&&a.set("lens_id",i.lens_id);let o=a.toString()?`${e.action}?${a.toString()}`:e.action;window.history.replaceState({},"",o)}catch(t){let n=t instanceof Error?t.message:String(t);this.showError(`Search failed: ${n}`)}finally{this.submitting=!1}}});var Y=(e,t)=>({lensId:e,rawAtName:t,init(){if(!this.lensId||!this.rawAtName)throw new Error("lensId and rawAtName are required");this.render()},render(){let n=this.$el,r=M(this.rawAtName.toLowerCase());n.className="query-token",n.dataset.token="lens",n.dataset.lensId=this.lensId,n.dataset.atName=r,n.textContent=`@${r}`,n.setAttribute("contenteditable","false"),n.style.cursor="pointer"},removeLens(){this.$store.search.clearLens()}});var z,fe,he,ye;function te(e){return{lang:e?.lang??z?.lang,message:e?.message,abortEarly:e?.abortEarly??z?.abortEarly,abortPipeEarly:e?.abortPipeEarly??z?.abortPipeEarly}}function me(e){return fe?.get(e)}function ve(e){return he?.get(e)}function ge(e,t){return ye?.get(e)?.get(t)}function ne(e){let t=typeof e;return t==="string"?`"${e}"`:t==="number"||t==="bigint"||t==="boolean"?`${e}`:t==="object"||t==="function"?(e&&Object.getPrototypeOf(e)?.constructor?.name)??"null":t}function S(e,t,n,r,s){let i=s&&"input"in s?s.input:n.value,l=s?.expected??e.expects??null,p=s?.received??ne(i),u={kind:e.kind,type:e.type,input:i,expected:l,received:p,message:`Invalid ${t}: ${l?`Expected ${l} but r`:"R"}eceived ${p}`,requirement:e.requirement,path:s?.path,issues:s?.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly},a=e.kind==="schema",o=s?.message??e.message??ge(e.reference,u.lang)??(a?ve(u.lang):null)??r.message??me(u.lang);o!==void 0&&(u.message=typeof o=="function"?o(u):o),a&&(n.typed=!1),n.issues?n.issues.push(u):n.issues=[u]}function O(e){return{version:1,vendor:"valibot",validate:t=>e["~run"]({value:t},te())}}function ke(e,t){let n=[...new Set(e)];return n.length>1?`(${n.join(` ${t} `)})`:n[0]??"never"}var xe=/^\d{4}-(?:0[1-9]|1[0-2])-(?:[12]\d|0[1-9]|3[01])[T ](?:0\d|1\d|2[0-3])(?::[0-5]\d){2}(?:\.\d{1,9})?(?:Z|[+-](?:0\d|1\d|2[0-3])(?::?[0-5]\d)?)$/u;function F(e){return{kind:"validation",type:"iso_timestamp",reference:F,async:!1,expects:null,requirement:xe,message:e,"~run"(t,n){return t.typed&&!this.requirement.test(t.value)&&S(this,"timestamp",t,n),t}}}function be(e,t,n){return typeof e.fallback=="function"?e.fallback(t,n):e.fallback}function se(e,t,n){return typeof e.default=="function"?e.default(t,n):e.default}function B(e,t){return{kind:"schema",type:"array",reference:B,expects:"Array",async:!1,item:e,message:t,get"~standard"(){return O(this)},"~run"(n,r){let s=n.value;if(Array.isArray(s)){n.typed=!0,n.value=[];for(let i=0;i<s.length;i++){let l=s[i],p=this.item["~run"]({value:l},r);if(p.issues){let u={type:"array",origin:"value",input:s,key:i,value:l};for(let a of p.issues)a.path?a.path.unshift(u):a.path=[u],n.issues?.push(a);if(n.issues||(n.issues=p.issues),r.abortEarly){n.typed=!1;break}}p.typed||(n.typed=!1),n.value.push(p.value)}}else S(this,"type",n,r);return n}}}function P(e,t){return{kind:"schema",type:"literal",reference:P,expects:ne(e),async:!1,literal:e,message:t,get"~standard"(){return O(this)},"~run"(n,r){return n.value===this.literal?n.typed=!0:S(this,"type",n,r),n}}}function j(e,t){return{kind:"schema",type:"object",reference:j,expects:"Object",async:!1,entries:e,message:t,get"~standard"(){return O(this)},"~run"(n,r){let s=n.value;if(s&&typeof s=="object"){n.typed=!0,n.value={};for(let i in this.entries){let l=this.entries[i];if(i in s||(l.type==="exact_optional"||l.type==="optional"||l.type==="nullish")&&l.default!==void 0){let p=i in s?s[i]:se(l),u=l["~run"]({value:p},r);if(u.issues){let a={type:"object",origin:"value",input:s,key:i,value:p};for(let o of u.issues)o.path?o.path.unshift(a):o.path=[a],n.issues?.push(o);if(n.issues||(n.issues=u.issues),r.abortEarly){n.typed=!1;break}}u.typed||(n.typed=!1),n.value[i]=u.value}else if(l.fallback!==void 0)n.value[i]=be(l);else if(l.type!=="exact_optional"&&l.type!=="optional"&&l.type!=="nullish"&&(S(this,"key",n,r,{input:void 0,expected:`"${i}"`,path:[{type:"object",origin:"key",input:s,key:i,value:s[i]}]}),r.abortEarly))break}}else S(this,"type",n,r);return n}}}function N(e,t){return{kind:"schema",type:"optional",reference:N,expects:`(${e.expects} | undefined)`,async:!1,wrapped:e,default:t,get"~standard"(){return O(this)},"~run"(n,r){return n.value===void 0&&(this.default!==void 0&&(n.value=se(this,n,r)),n.value===void 0)?(n.typed=!0,n):this.wrapped["~run"](n,r)}}}function T(e){return{kind:"schema",type:"string",reference:T,expects:"string",async:!1,message:e,get"~standard"(){return O(this)},"~run"(t,n){return typeof t.value=="string"?t.typed=!0:S(this,"type",t,n),t}}}function ee(e){let t;if(e)for(let n of e)t?t.push(...n.issues):t=n.issues;return t}function L(e,t){return{kind:"schema",type:"union",reference:L,expects:ke(e.map(n=>n.expects),"|"),async:!1,options:e,message:t,get"~standard"(){return O(this)},"~run"(n,r){let s,i,l;for(let p of this.options){let u=p["~run"]({value:n.value},r);if(u.typed){if(!u.issues){s=u;break}i?i.push(u):i=[u]}else l?l.push(u):l=[u]}if(s)return s;if(i){if(i.length===1)return i[0];S(this,"type",n,r,{issues:ee(i)}),n.typed=!0}else{if(l?.length===1)return l[0];S(this,"type",n,r,{issues:ee(l)})}return n}}}function re(...e){return{...e[0],pipe:e,get"~standard"(){return O(this)},"~run"(t,n){for(let r of e)if(r.kind!=="metadata"){if(t.issues&&(r.kind==="schema"||r.kind==="transformation")){t.typed=!1;break}t.issues&&(n.abortEarly||n.abortPipeEarly)||(t=r["~run"](t,n))}return t}}}function ie(e,t,n){let r=e["~run"]({value:t},te(n));return{typed:r.typed,success:!r.issues,output:r.value,issues:r.issues}}var we=j({role:T(),content:N(L([T(),B(j({type:N(T()),text:N(T())}))])),model:N(T())}),$e=j({uuid:T(),type:L([P("user"),P("assistant")]),timestamp:re(T(),F()),sessionId:N(T()),message:we});function _e(e,t){let n=ie($e,e);return n.success?[]:n.issues.map(r=>{let s=r.path?.map(i=>i.key).join(".")||"record";return`Line ${t}: ${s} - ${r.message}`})}function Te(e){let t=e.trim().split(`
`),n=new Map,r=50,s={totalLines:t.length,parsed:0,skipped:0,errors:{invalidJSON:[],invalidType:0,missingMessage:0,missingRole:0,emptyContent:0,invalidTimestamp:[],validationErrors:[]}};t.forEach((p,u)=>{let a=u+1;if(!p.trim())return;let o;try{o=JSON.parse(p)}catch(b){s.errors.invalidJSON.length<r&&s.errors.invalidJSON.push(`Line ${a}: ${b.message}`),s.skipped++;return}let m=_e(o,a);if(m.length>0){let b=r-s.errors.validationErrors.length;b>0&&s.errors.validationErrors.push(...m.slice(0,b)),s.skipped++;return}if(o.type!=="user"&&o.type!=="assistant"){s.errors.invalidType++,s.skipped++;return}let h=o.message;if(!h||!h.role){s.errors.missingRole++,s.skipped++;return}let g=Array.isArray(h.content)?h.content.map(b=>b.type==="text"?b.text:"").join(`
`):h.content;if(!g||!g.trim()){s.errors.emptyContent++,s.skipped++;return}let v=o.sessionId||`generated_${o.uuid}`;n.has(v)||n.set(v,[]);let y=new Date(o.timestamp);n.get(v).push({uuid:o.uuid,role:h.role,content:g.trim(),model:h.model||null,created_at:Math.floor(y.getTime()/1e3),timestamp:o.timestamp,sessionId:v}),s.parsed++});let i=[];for(let p of n.values()){let u=null;for(let a of p)a.role==="user"?(u&&u.length>0&&i.push(u),u=[a]):a.role==="assistant"&&u&&u.push(a);u&&u.length>0&&i.push(u)}return{threads:i.map((p,u)=>({id:u,threadId:`import_${p[0].sessionId}_${p[0].uuid}`,userMessage:p[0],assistantMessages:p.slice(1),selected:!1})),report:s}}var ae={name:"Claude Code JSONL",fileExtension:".jsonl",importSource:"claude_code_jsonl",parse:Te};var Ae={"claude-code":ae},oe=()=>({preview:!1,importing:!1,complete:!1,threads:[],parseReport:null,selectedFormat:"claude-code",banner:{visible:!1,type:"",message:"",timeout:null},get currentValidator(){return Ae[this.selectedFormat]},handleFormatChange(){this.threads=[],this.parseReport=null,this.preview=!1,this.closeBanner(),this.$refs.fileInput&&(this.$refs.fileInput.value="")},showBanner(e,t){this.banner.visible=!0,this.banner.type=e,this.banner.message=t,this.banner.timeout&&clearTimeout(this.banner.timeout),this.banner.timeout=setTimeout(()=>{this.banner.visible=!1},5e3)},closeBanner(){this.banner.visible=!1,this.banner.timeout&&clearTimeout(this.banner.timeout)},get selectedCount(){return this.threads.filter(e=>e.selected).length},get totalMessageCount(){return this.threads.filter(e=>e.selected).reduce((e,t)=>e+1+t.assistantMessages.length,0)},get parseReportSummary(){if(!this.parseReport)return"";let e=this.parseReport,t=[];if(t.push(`${e.parsed} records parsed`),e.skipped>0){let n=[];e.errors.invalidJSON.length>0&&n.push(`${e.errors.invalidJSON.length} invalid JSON`),e.errors.invalidType>0&&n.push(`${e.errors.invalidType} invalid type`),e.errors.emptyContent>0&&n.push(`${e.errors.emptyContent} empty content`),e.errors.invalidTimestamp.length>0&&n.push(`${e.errors.invalidTimestamp.length} invalid timestamp`),e.errors.validationErrors.length>0&&n.push(`${e.errors.validationErrors.length} validation errors`),t.push(`${e.skipped} skipped: ${n.join(", ")}`)}return t.join(", ")},handleFileSelect(e){let t=e.target.files?.[0];if(!t)return;let n=new FileReader;n.onload=r=>{try{let s=r.target.result,{threads:i,report:l}=this.currentValidator.parse(s);this.threads=i,this.parseReport=l,this.preview=!0,l.skipped>0&&this.showBanner("error",this.parseReportSummary)}catch(s){console.error("Parse error:",s),this.showBanner("error",`Failed to parse file: ${s.message}`)}},n.readAsText(t)},toggleAll(){let e=this.threads.every(t=>t.selected);this.threads.forEach(t=>t.selected=!e)},cancelImport(){this.preview=!1,this.threads=[],this.parseReport=null,this.closeBanner(),this.$refs.fileInput.value=""},async executeImport(){if(!(this.importing||this.selectedCount===0)){this.importing=!0;try{let e=[];for(let s of this.threads.filter(i=>i.selected)){e.push({uuid:s.userMessage.uuid,thread_id:s.threadId,role:s.userMessage.role,content:s.userMessage.content,model:s.userMessage.model,created_at:s.userMessage.created_at,imported_external_id:s.userMessage.uuid,meta:{imported_external_session_id:s.userMessage.sessionId,imported_external_created_at:s.userMessage.timestamp}});for(let i of s.assistantMessages)e.push({uuid:i.uuid,thread_id:s.threadId,role:i.role,content:i.content,model:i.model,created_at:i.created_at,imported_external_id:i.uuid,meta:{imported_external_session_id:i.sessionId,imported_external_created_at:i.timestamp}})}let t=await fetch("/v1/import/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({import_source:this.currentValidator.importSource,messages:e})});if(!t.ok){let s=await t.json().catch(()=>({}));throw new Error(s.detail||`HTTP ${t.status}`)}let n=await t.json();this.preview=!1,this.complete=!0;let r=n.skipped_duplicates>0?`Imported ${n.imported} messages (skipped ${n.skipped_duplicates} duplicates)`:`Successfully imported ${n.imported} messages`;this.showBanner("success",r)}catch(e){console.error("Import error:",e),this.showBanner("error",`Failed to import: ${e.message}`),this.importing=!1}}}});var ue=()=>({pending:!1,assistantEventSource:null,jobPollTimeout:null,jobPollAttempt:0,createPlaceholder(e){let t=this.$refs.placeholderTemplate.content.cloneNode(!0),n=t.querySelector(".message");return n.dataset.tempId=e,t},parseHtmlElement(e){let t=document.createElement("template");return t.innerHTML=String(e).trim(),t.content.firstElementChild},cleanupAssistantStream(){this.assistantEventSource&&this.assistantEventSource.close(),this.assistantEventSource=null},cleanupJobPoll(){this.jobPollTimeout&&clearTimeout(this.jobPollTimeout),this.jobPollTimeout=null,this.jobPollAttempt=0},async pollJobStatus(e,t){try{let n=await fetch(`/v1/threads/${e}/activity`,{headers:{Accept:"application/json"}});if(!n.ok)return;if((await n.json())?.job_events?.[0]?.status==="failed"){let l=this.$refs.responses.querySelector(`[data-temp-id="${t}"]`);l&&l.remove(),this.cleanupJobPoll();return}this.jobPollAttempt+=1;let i=Math.min(1e3*Math.pow(2,this.jobPollAttempt),3e4);this.jobPollTimeout=setTimeout(()=>this.pollJobStatus(e,t),i)}catch(n){console.error("Error polling job status:",n),this.jobPollAttempt+=1;let r=Math.min(1e3*Math.pow(2,this.jobPollAttempt),3e4);this.jobPollTimeout=setTimeout(()=>this.pollJobStatus(e,t),r)}},startEventStreams(e,t,{afterAssistantUuid:n=null}={}){if(this.assistantEventSource)return;let r=new URL(`/v1/threads/${e}/stream`,window.location.origin);r.searchParams.set("role","assistant"),n&&r.searchParams.set("after_uuid",n),this.assistantEventSource=new EventSource(r),this.assistantEventSource.addEventListener("assistant",async s=>{try{let l=JSON.parse(s?.data||"{}")?.uuid;if(!l)return;let p=await fetch(`/v1/messages/${l}/fragment`,{headers:{Accept:"text/html"}});if(!p.ok)return;let u=await p.text(),a=this.parseHtmlElement(u),o=this.$refs.responses.querySelector(`[data-temp-id="${t}"]`);o&&a&&o.replaceWith(a),this.cleanupJobPoll()}finally{this.cleanupAssistantStream()}}),this.assistantEventSource.addEventListener("error",()=>this.cleanupAssistantStream()),this.jobPollAttempt=0,this.pollJobStatus(e,t)},init(){if(!this.$refs.responses||this.$refs.responses.children.length)return;let e=this.$el?.dataset?.threadId;if(!e)return;let t="initial",n=this.createPlaceholder(t);this.$refs.responses.prepend(n),this.startEventStreams(e,t)},async regenerate(e){if(this.pending)return;let t=e?.currentTarget,n=t?.dataset?.threadId,r=t?.dataset?.model,s=t?.dataset?.promptContent;if(!n||!s)return;this.pending=!0;let i=Math.random().toString(36).slice(2,10),l=this.createPlaceholder(i);this.$refs.responses.prepend(l);try{let u=this.$refs.responses.querySelector(".message[data-uuid]")?.dataset?.uuid||null,a=await fetch("/v1/ask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:s,thread_id:n,lens_id:this.$refs?.lensSelect?.value||void 0,model:r})});if(!a.ok)throw new Error(`Ask HTTP ${a.status}`);this.startEventStreams(n,i,{afterAssistantUuid:u})}catch(p){console.error("Error:",p);let u=this.$refs.responses.querySelector(`[data-temp-id="${i}"]`);u&&u.remove()}finally{this.pending=!1}}});var le=()=>({deleting:null,async deleteThread(e){if(confirm("Delete this thread? This will soft-delete all messages in the thread.")){this.deleting=e;try{let t=await fetch(`/v1/threads/${e}`,{method:"DELETE"});if(!t.ok){let n=await t.json().catch(()=>({}));throw new Error(n.detail||`HTTP ${t.status}`)}window.location.reload()}catch(t){console.error("Delete error:",t),alert(`Failed to delete thread: ${t.message}`),this.deleting=null}}}});function ce(e,t){if(typeof e!="string")throw new TypeError("highlightCode expects a string");let n=qe(e,t),r=[],s=[],i=[],l=[],p=[],u=c=>{if(!Number.isInteger(c)||c<0)throw new TypeError("encodeIndex expects a non-negative integer");let d="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",x=d.length,k=c,$="";do $=d[k%x]+$,k=Math.floor(k/x);while(k>0);return $},a=c=>`HLSTR${u(c)}`,o=c=>`HLCMT${u(c)}`,m=c=>`HLKW${u(c)}`,h=c=>`HLBI${u(c)}`,g=c=>`HLNUM${u(c)}`,v=c=>{let d="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",x=d.length,k=0;for(let $ of String(c)){let w=d.indexOf($);if(w===-1)throw new Error("Invalid placeholder encoding");k=k*x+w}return k},y=e;n==="python"?(y=y.replace(/#[^\n]*/g,c=>{let d=s.length;return s.push(c),o(d)}),y=y.replace(/'''[\s\S]*?'''|"""[\s\S]*?"""/g,c=>{let d=r.length;return r.push(c),a(d)}),y=y.replace(/'([^'\\]|\\.)*?'|"([^"\\]|\\.)*?"/g,c=>{let d=r.length;return r.push(c),a(d)})):n==="sql"?(y=y.replace(/--[^\n]*/g,c=>{let d=s.length;return s.push(c),o(d)}),y=y.replace(/'([^'\\]|\\.)*?'/g,c=>{let d=r.length;return r.push(c),a(d)})):(y=y.replace(/\/\/[^\n]*/g,c=>{let d=s.length;return s.push(c),o(d)}),y=y.replace(/\/\*[\s\S]*?\*\//g,c=>{let d=s.length;return s.push(c),o(d)}),y=y.replace(/'([^'\\]|\\.)*?'|"([^"\\]|\\.)*?"|`([^`\\]|\\.)*?`/g,c=>{let d=r.length;return r.push(c),a(d)})),y=J(y);let b=c=>c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),E=Ie(n);if(E.length>0){let c=n==="sql"?"gi":"g",d=new RegExp(`\\b(${E.map(b).join("|")})\\b`,c);y=y.replace(d,x=>{let k=i.length;return i.push(x),m(k)})}let f=Se(n);if(f.length>0){let c=n==="sql"?"gi":"g",d=new RegExp(`\\b(${f.map(b).join("|")})\\b`,c);y=y.replace(d,x=>{let k=l.length;return l.push(x),h(k)})}return y=y.replace(/\b\d+(\.\d+)?\b/g,c=>{let d=p.length;return p.push(c),g(d)}),y=y.replace(/\u0001HLSTR([A-Za-z]+)\u0001/g,(c,d)=>{let x=v(d),k=r[x];if(k===void 0)throw new Error("Invalid string placeholder index");return`<span class="hl-str">${J(k)}</span>`}),y=y.replace(/\u0001HLCMT([A-Za-z]+)\u0001/g,(c,d)=>{let x=v(d),k=s[x];if(k===void 0)throw new Error("Invalid comment placeholder index");return`<span class="hl-cmt">${J(k)}</span>`}),y=y.replace(/\u0001HLNUM([A-Za-z]+)\u0001/g,(c,d)=>{let x=v(d),k=p[x];if(k===void 0)throw new Error("Invalid number placeholder index");return`<span class="hl-num">${k}</span>`}),y=y.replace(/\u0001HLBI([A-Za-z]+)\u0001/g,(c,d)=>{let x=v(d),k=l[x];if(k===void 0)throw new Error("Invalid builtin placeholder index");return`<span class="hl-bi">${k}</span>`}),y=y.replace(/\u0001HLKW([A-Za-z]+)\u0001/g,(c,d)=>{let x=v(d),k=i[x];if(k===void 0)throw new Error("Invalid keyword placeholder index");return`<span class="hl-kw">${k}</span>`}),y}function J(e){if(typeof e!="string")throw new TypeError("escapeHtml expects a string");return e.replace(/[&<>"']/g,t=>t==="&"?"&amp;":t==="<"?"&lt;":t===">"?"&gt;":t==='"'?"&quot;":"&apos;")}function qe(e,t){if(t){let n=t.toLowerCase();return n==="js"||n==="javascript"||n==="typescript"||n==="ts"?"javascript":n==="py"||n==="python"?"python":n==="sql"||n==="postgres"||n==="postgresql"||n==="mysql"?"sql":n==="go"||n==="golang"?"go":n==="rs"||n==="rust"?"rust":n==="sh"||n==="bash"||n==="shell"?"shell":n}return/\b(def|class)\s+\w+[\(:]/.test(e)?"python":/\b(const|let|var|function)\s+\w+/.test(e)?"javascript":/^\s*(SELECT|INSERT|UPDATE|DELETE|CREATE|ALTER|DROP)\b/mi.test(e)?"sql":/\bfn\s+\w+\(/.test(e)?"rust":/\bfunc\s+\w+\(/.test(e)?"go":"generic"}function Ie(e){let t={python:["def","class","if","else","elif","for","while","return","import","from","as","try","except","finally","with","lambda","yield","async","await","raise","pass","break","continue","in","is","not","and","or"],javascript:["function","const","let","var","if","else","for","while","return","import","export","default","class","extends","async","await","yield","typeof","new","delete","this","super","static","try","catch","finally","throw","break","continue","switch","case"],sql:["SELECT","FROM","WHERE","JOIN","INNER","LEFT","RIGHT","OUTER","ON","INSERT","INTO","VALUES","UPDATE","SET","DELETE","CREATE","TABLE","ALTER","DROP","INDEX","ORDER","BY","GROUP","HAVING","LIMIT","OFFSET","AS","AND","OR","NOT","IN","LIKE","BETWEEN"],go:["func","package","import","var","const","type","struct","interface","if","else","for","range","return","defer","go","chan","select","case","switch","break","continue"],rust:["fn","let","mut","const","static","struct","enum","impl","trait","type","if","else","match","for","while","loop","return","break","continue","use","mod","pub","crate"],shell:["if","then","else","elif","fi","for","while","do","done","case","esac","function","return","exit","export","source"],generic:[]};return t[e]||t.generic}function Se(e){let t={python:["True","False","None","self","str","int","float","bool","list","dict","tuple","set","len","range","print","open","type","isinstance","super","__init__","__name__"],javascript:["true","false","null","undefined","NaN","Infinity","console","window","document","Array","Object","String","Number","Boolean","Math","Date","Promise","JSON"],sql:["NULL","TRUE","FALSE","COUNT","SUM","AVG","MIN","MAX","DISTINCT","EXISTS"],go:["true","false","nil","make","new","len","cap","append","copy","delete","panic","recover"],rust:["true","false","None","Some","Ok","Err","Vec","String","Option","Result","println","panic"],shell:["echo","cd","ls","pwd","cat","grep","sed","awk","find","chmod","chown"],generic:["true","false","null","undefined"]};return t[e]||t.generic}function A(e){if(typeof e!="string")throw new TypeError("escapeHtml expects a string");return e.replace(/[&<>"']/g,t=>t==="&"?"&amp;":t==="<"?"&lt;":t===">"?"&gt;":t==='"'?"&quot;":"&#39;")}function C(e){if(typeof e!="string")throw new TypeError("parseInline expects a string");let t=[],n=[],r=[],s=p=>`ROSECODE${p}`,i=p=>`ROSELINK${p}`,l=p=>`ROSEAUTOLINK${p}`;return e=e.replace(/`([^`]*?)`/g,(p,u)=>{let a=t.length;return t.push(A(u)),s(a)}),e=e.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(p,u,a)=>{let o=a.trim();if(!(/^(https?|mailto|tel):/i.test(o)||/^[/.#]/.test(o)))return u;let h=n.length,g=A(u),v=A(o);return n.push(`<a href="${v}" target="_blank" rel="noopener noreferrer">${g}</a>`),i(h)}),e=e.replace(/\bhttps?:\/\/[^\s<>"']+/g,p=>{let u=p,a="";for(;/[),.;:!?\\\]]$/.test(u);)a=u.slice(-1)+a,u=u.slice(0,-1);if(!u)return A(p);let o=r.length,m=A(u);return r.push(`<a href="${m}" target="_blank" rel="noopener noreferrer">${m}</a>${A(a)}`),l(o)}),e=A(e),e=e.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),e=e.replace(/__([^_]+)__/g,"<strong>$1</strong>"),e=e.replace(/\*([^*]+)\*/g,"<em>$1</em>"),e=e.replace(/_([^_]+)_/g,"<em>$1</em>"),e=e.replace(/\u0001ROSELINK(\d+)\u0001/g,(p,u)=>{let a=n[Number(u)];if(a===void 0)throw new Error("Invalid link placeholder index");return a}),e=e.replace(/\u0001ROSEAUTOLINK(\d+)\u0001/g,(p,u)=>{let a=r[Number(u)];if(a===void 0)throw new Error("Invalid auto-link placeholder index");return a}),e=e.replace(/\u0001ROSECODE(\d+)\u0001/g,(p,u)=>{let a=t[Number(u)];if(a===void 0)throw new Error("Invalid code placeholder index");return`<code>${a}</code>`}),e}function pe(e){if(typeof e!="string")throw new TypeError("markdownToHtml expects a string");let t=1e5;if(e.length>t){let b=e.slice(0,t),E=`<div class="markdown-error">Content exceeds ${t} characters, showing truncated...`;return E+=`</div><pre>${A(b)}</pre>`,E}e=e.replace(/\r\n?/g,`
`);let n=e.split(`
`),r="",s=!1,i=!1,l=!1,p=!1,u=[],a=[],o="",m=[];function h(){u.length>0&&(r+=`<p>${C(u.join(" "))}</p>
`,u=[])}function g(){l&&(r+=`<blockquote>${a.join(`<br />
`)}</blockquote>
`,a=[],l=!1)}function v(){if(!p)return;let b=m.join(`
`),E=o?` class="language-${A(o)}"`:"",f=ce(b,o);r+=`<pre><code${E}>${f}</code></pre>
`,o="",m=[],p=!1}function y(){s&&(r+=`</ul>
`,s=!1),i&&(r+=`</ol>
`,i=!1)}for(let b=0;b<n.length;b++){let E=n[b],f=E.match(/^```([^\s`]+)?\s*$/);if(f){h(),y(),g(),p?v():(p=!0,o=(f[1]||"").trim(),m=[]);continue}if(p){m.push(E);continue}if(!E.trim()){h(),y(),g();continue}if(/^(\-\-\-|\*\*\*|___)\s*$/.test(E.trim())){h(),y(),g(),r+=`<hr />
`;continue}if(/^\s*>\s?/.test(E)){h(),y(),l||(l=!0);let k=E.replace(/^\s*>\s?/,"");a.push(C(k));continue}let c=E.match(/^(#{1,6})\s+(.*)$/);if(c){h(),y(),g();let k=c[1].length,$=c[2].trim();r+=`<h${k}>${C($)}</h${k}>
`;continue}let d=E.match(/^\s*(\d+)\.\s+(.*)$/);if(d){h(),g(),s&&(r+=`</ul>
`,s=!1),i||(r+=`<ol>
`,i=!0),r+=`<li>${C(d[2])}</li>
`;continue}let x=E.match(/^\s*[-*+]\s+(.*)$/);if(x){h(),g(),i&&(r+=`</ol>
`,i=!1),s||(r+=`<ul>
`,s=!0),r+=`<li>${C(x[1])}</li>
`;continue}g(),y(),u.push(E)}return v(),h(),y(),g(),r.trim()}document.addEventListener("alpine:init",()=>{if(!window.TRANSPORT?.search)throw new Error("TRANSPORT.search not found");Alpine.store("search",{...window.TRANSPORT.search,clearLens(){this.lens_id=""}}),Alpine.magic("markdown",()=>pe),Alpine.data("askButton",G),Alpine.data("responseMessage",X),Alpine.data("searchForm",Q),Alpine.data("lensToken",Y),Alpine.data("importPage",oe),Alpine.data("threadMessagesPage",ue),Alpine.data("threadsListPage",le)});})();
