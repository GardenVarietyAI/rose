(()=>{var G=()=>({disabled:!1,label:"Ask",async ask(){let e=this.$el.closest("form")?.querySelector('[name="q"]:not([disabled])')?.value?.trim()||"";if(!(!e||this.disabled)){this.disabled=!0;try{let r=this.$el.closest("form")?.querySelector('select[name="lens_id"]')?.value?.trim()||"",i=await(await fetch("/v1/ask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e,lens_id:r||void 0})})).json();if(!i?.thread_id)throw new Error("Missing thread_id");let u=r?`?lens_id=${encodeURIComponent(r)}`:"";window.location.href="/v1/threads/"+i.thread_id+u}catch(t){alert("Error: "+(t?.message||String(t)))}finally{this.disabled=!1}}}});var X=()=>({uuid:null,accepted:!1,collapsed:!1,expanded:!1,editing:!1,draft:"",original:"",editable:!1,saving:!1,init(){this.uuid=this.$el.dataset.uuid,this.accepted=this.$el.classList.contains("accepted");let e=this.$refs?.sourceContent;this.editable=!!e;let t=this.$el.querySelector(".message-content");if(t&&!this.editable){let r=t.textContent?.trim()||"";t.innerHTML=this.$markdown(r)}if(!this.editable)return;let n=e.content?.textContent;this.original=(n??t?.innerText??"").trimEnd(),this.draft=this.original},startEdit(){this.editable&&(this.editing=!0,this.draft=this.original,this.$nextTick(()=>this.$refs?.editor?.focus()))},cancelEdit(){this.editable&&(this.editing=!1,this.draft=this.original)},async saveEdit(){if(!(!this.editable||this.saving)){this.saving=!0;try{let e=await fetch(`/v1/messages/${this.uuid}/revisions`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({content:this.draft})});if(!e.ok)throw new Error(`HTTP ${e.status}`);window.location.reload()}catch(e){console.error("Error:",e),this.saving=!1}}},async toggleAccepted(){try{let e=await fetch(`/v1/messages/${this.uuid}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({accepted:!this.accepted})});if(!e.ok)throw new Error(`HTTP ${e.status}`);this.accepted=!this.accepted}catch(e){console.error("Error:",e)}}});function _(e){let t=[];for(let n of e)if(n.type==="text")if(t.length>0&&t[t.length-1].type==="text"){let r=t[t.length-1];r.value+=n.value}else t.push({type:"text",value:n.value});else t.push(n);return(t.length===0||t[t.length-1].type!=="text")&&t.push({type:"text",value:""}),t}function H(e){let t=[];for(let n of e)n.type==="text"&&n.value&&t.push(n.value);return t.join("")}function D(e,t=[]){let n=[];for(let r of t)n.push({type:"lens",lensId:r.lensId,atName:r.atName});return e&&n.push({type:"text",value:e}),_(n)}function I(e,t){let n=Math.max(0,Math.min(t.tokenIndex,e.length-1)),r=e[n],s=r.type==="text"?r.value.length:0,i=Math.max(0,Math.min(t.offset,s));return{tokenIndex:n,offset:i}}function V(e,t){let{tokens:n,caret:r}=e;if(t.type==="insertText"){let{at:s,text:i}=t,u=[...n],p=u[s.tokenIndex];if(p.type!=="text")throw new Error("Cannot insert text into non-text token");let o=p.value.slice(0,s.offset),a=p.value.slice(s.offset);u[s.tokenIndex]={type:"text",value:o+i+a};let l=_(u),m={tokenIndex:s.tokenIndex,offset:s.offset+i.length},f=I(l,m),g={type:"deleteRange",from:s,to:{tokenIndex:s.tokenIndex,offset:s.offset+i.length}};return{buffer:{tokens:l,caret:f},inverse:g}}if(t.type==="deleteRange"){let{from:s,to:i}=t,u=[...n],p=[];if(s.tokenIndex===i.tokenIndex){let c=u[s.tokenIndex];if(c.type!=="text")throw new Error("Cannot delete from non-text token");let d=c.value.slice(0,s.offset),x=c.value.slice(s.offset,i.offset),k=c.value.slice(i.offset);u[s.tokenIndex]={type:"text",value:d+k};let $=_(u),w={tokenIndex:s.tokenIndex,offset:s.offset},q=I($,w);return{buffer:{tokens:$,caret:q},inverse:{type:"insertText",at:s,text:x}}}let o=u[s.tokenIndex],a=u[i.tokenIndex];if(o.type!=="text"||a.type!=="text")throw new Error("Cross-token delete requires text tokens at boundaries");let l=o.value.slice(0,s.offset),m=o.value.slice(s.offset),f=a.value.slice(0,i.offset),g=a.value.slice(i.offset);for(let c=s.tokenIndex;c<=i.tokenIndex;c++)p.push(u[c]);p[0]={type:"text",value:m},p[p.length-1]={type:"text",value:f};let v=[];for(let c=0;c<p.length;c++){let d=p[c];if(d.type==="text")if(v.length>0&&v[v.length-1].type==="text"){let x=v[v.length-1];v[v.length-1]={type:"text",value:x.value+d.value}}else v.push(d);else v.push(d)}for(let c=i.tokenIndex;c>=s.tokenIndex;c--)u.splice(c,1);u.splice(s.tokenIndex,0,{type:"text",value:l+g});let y=_(u),b={tokenIndex:s.tokenIndex,offset:s.offset},E=I(y,b);return{buffer:{tokens:y,caret:E},inverse:{type:"insertTokens",at:s,tokens:v}}}if(t.type==="replaceToken"){let{index:s,token:i}=t,u=[...n],p=u[s];u[s]=i;let o=_(u),a=I(o,r);return{buffer:{tokens:o,caret:a},inverse:{type:"replaceToken",index:s,token:p}}}if(t.type==="insertTokens"){let{at:s,tokens:i}=t,u=[...n],p=u[s.tokenIndex];if(p.type!=="text")throw new Error("Cannot insert tokens into non-text token");let o=p.value.slice(0,s.offset),a=p.value.slice(s.offset),l=[...i];if(l.length>0){let h=l[0];h.type==="text"?l[0]={type:"text",value:o+h.value}:o&&l.unshift({type:"text",value:o});let c=l[l.length-1];c.type==="text"?l[l.length-1]={type:"text",value:c.value+a}:a&&l.push({type:"text",value:a})}else l.push({type:"text",value:o+a});u.splice(s.tokenIndex,1,...l);let m=_(u),f=i[i.length-1],g=0,v=0;if(f&&f.type!=="text"){let h=0;for(let w=0;w<s.tokenIndex;w++){let q=n[w];q.type==="text"&&(h+=q.value.length)}h+=s.offset;let c=h;for(let w of i)w.type==="text"&&(c+=w.value.length);let d=0;for(let w of i)w.type!=="text"&&d++;let x=0,k=0,$=!1;for(let w=0;w<m.length;w++){let q=m[w];if(q.type==="text"){if(!$&&x>=h&&($=!0),c<=x+q.value.length){g=w,v=c-x;break}x+=q.value.length}else if($&&(k++,k===d)){g=w+1,v=0;break}}}else{let h=o.length;for(let d of i)d.type==="text"&&(h+=d.value.length);let c=0;for(let d=0;d<m.length;d++){let x=m[d];if(x.type==="text"){if(h<=c+x.value.length){g=d,v=h-c;break}c+=x.value.length}}}let b=I(m,{tokenIndex:g,offset:v});return{buffer:{tokens:m,caret:b},inverse:{type:"deleteRange",from:s,to:b}}}throw new Error(`Unknown op type: ${t.type}`)}function M(e){let t=document.createElement("div");return t.textContent=e||"",t.textContent||""}function U(e,t){t.textContent="";let n=new Map,r=0;for(let s=0;s<e.length;s++){let i=e[s];if(i.type==="lens"){let u=document.createElement("span");u.setAttribute("x-data",`lensToken('${i.lensId}', '${i.atName}')`),u.setAttribute("x-on:click","removeLens()"),u.setAttribute("data-token","lens"),t.appendChild(u),n.set(s,{node:u,textStart:r,textEnd:r})}else if(i.type==="text"){let u=document.createTextNode(M(i.value));t.appendChild(u),n.set(s,{node:u,textStart:r,textEnd:r+i.value.length}),r+=i.value.length}}return n}function W(e,t,n){let r=t.get(e.tokenIndex);if(!r)return null;if(r.node.nodeType===Node.TEXT_NODE)return{node:r.node,offset:e.offset};if(e.offset===0)return{node:n,offset:Array.from(n.childNodes).indexOf(r.node)};let s=e.tokenIndex+1,i=t.get(s);return i?{node:n,offset:Array.from(n.childNodes).indexOf(i.node)}:{node:n,offset:n.childNodes.length}}function P(e,t,n,r){for(let[s,i]of n.entries())if(i.node===e)return e.nodeType===Node.TEXT_NODE?{tokenIndex:s,offset:Math.min(t,i.textEnd-i.textStart)}:{tokenIndex:s,offset:0};if(e===r){let s=Array.from(r.childNodes);if(t>=s.length){let u=n.size-1,p=n.get(u);return p&&p.node.nodeType===Node.TEXT_NODE?{tokenIndex:u,offset:p.textEnd-p.textStart}:{tokenIndex:u,offset:0}}let i=s[t];for(let[u,p]of n.entries())if(p.node===i)return{tokenIndex:u,offset:0}}return{tokenIndex:n.size-1,offset:0}}var he=/(?:^|[^A-Za-z0-9-])@([A-Za-z0-9-]*)/g;function Z(e,t){let n="",r=[],s=0,i=-1;for(let f=0;f<e.length;f++){let g=e[f];if(g.type==="text"){let v=n.length;n+=g.value,r.push({tokenIndex:f,startChar:v,endChar:n.length}),f<t.tokenIndex?s+=g.value.length:f===t.tokenIndex&&(s+=t.offset,i=r.length-1)}else r.push({tokenIndex:f,startChar:n.length,endChar:n.length}),f<t.tokenIndex&&(i=r.length-1)}if(i===-1||n.length===0)return null;let u=n.slice(0,s),p=Array.from(u.matchAll(he));if(p.length===0)return null;let o=p[p.length-1],a=o[0].startsWith("@")?0:1,l=o.index+a,m=l+o[0].length-a;if(m!==s)return null;for(let f of r)if(l>=f.startChar&&l<f.endChar)return m>f.endChar?null:{tokenIndex:f.tokenIndex,startOffset:l-f.startChar,endOffset:m-f.startChar,query:o[1].toLowerCase(),raw:o[0].slice(a)};return null}function K(e){let t=e,n={tokens:D(""),caret:{tokenIndex:0,offset:0}},r=null,s=!1,i=()=>{if(!t||!r||document.activeElement!==t)return;let a=W(n.caret,r,t);if(!a)return;let l=window.getSelection();if(!l)return;let m=document.createRange();m.setStart(a.node,a.offset),m.collapse(!0),l.removeAllRanges(),l.addRange(m)},u=()=>{if(!t||!r)return;let a=window.getSelection();if(!a||!a.rangeCount)return;let l=a.getRangeAt(0);n.caret=P(l.startContainer,l.startOffset,r,t)},p=()=>{if(!t)return;let a=[],l=new Map,m=0,f=0,g=!1;for(let h of t.childNodes){if(h.nodeType===Node.ELEMENT_NODE&&h.dataset?.token==="lens"){a.push({type:"lens",lensId:h.dataset.lensId,atName:h.dataset.atName}),l.set(f++,{node:h,textStart:m,textEnd:m});continue}if(h.nodeType===Node.TEXT_NODE){let c=h.textContent||"";a.push({type:"text",value:c}),l.set(f++,{node:h,textStart:m,textEnd:m+c.length}),m+=c.length;continue}h.nodeType===Node.ELEMENT_NODE&&h.tagName==="BR"&&(g=!0)}let v=a.some((h,c)=>h.type==="text"&&c>0&&a[c-1].type==="text"),y=a.length>0&&a[a.length-1].type==="lens";(v||y||g)&&(g=!0);let b=n.caret,E=window.getSelection();if(E&&E.rangeCount){let h=E.getRangeAt(0);b=P(h.startContainer,h.startOffset,l,t)}if(g){let h=_(a);b=I(h,b),n={tokens:h,caret:b},o()}else{let h=_(a);b=I(h,b),n={tokens:h,caret:b},r=l}},o=()=>{if(!(!t||s)){s=!0;try{r=U(n.tokens,t),i(),window.Alpine&&window.Alpine.initTree(t)}finally{s=!1}}};return{getBuffer(){return n},setBuffer(a){n=a,o()},loadFromQuery(a,l){let m=[];l?.lensId&&l?.atName&&m.push({lensId:l.lensId,atName:l.atName});let f=D(a,m),g=f.length-1,v=f[g];n={tokens:f,caret:{tokenIndex:g,offset:v?.type==="text"?v.value.length:0}},o()},syncFromDOM(){p()},syncBufferOnly(){if(!t)return;let a=[],l=new Map,m=0,f=0;for(let h of t.childNodes)if(h.nodeType===Node.ELEMENT_NODE&&h.dataset?.token==="lens")a.push({type:"lens",lensId:h.dataset.lensId,atName:h.dataset.atName}),l.set(f++,{node:h,textStart:m,textEnd:m});else if(h.nodeType===Node.TEXT_NODE){let c=h.textContent||"";a.push({type:"text",value:c}),l.set(f++,{node:h,textStart:m,textEnd:m+c.length}),m+=c.length}a.length===0&&(a.push({type:"text",value:""}),l.set(0,{node:null,textStart:0,textEnd:0}));let g=window.getSelection(),v={tokenIndex:0,offset:0};if(g&&g.rangeCount){let h=g.getRangeAt(0);v=P(h.startContainer,h.startOffset,l,t)}let y=a.length-1;v.tokenIndex=Math.max(0,Math.min(v.tokenIndex,y));let b=a[v.tokenIndex],E=b?.type==="text"?b.value.length:0;v.offset=Math.max(0,Math.min(v.offset,E)),n={tokens:a,caret:v},r=l},serialize(){return H(n.tokens)},detectMention(){return Z(n.tokens,n.caret)},insertLensToken(a,l,m){if(!t)return;let f=window.getSelection();if(!f||!f.rangeCount)return;let g=r.get(a.tokenIndex);if(!g||!g.node)return;let v=g.node,y=v.textContent||"",b=y.slice(0,a.startOffset),E=y.slice(a.endOffset),h=document.createElement("span");h.setAttribute("x-data",`lensToken('${l}', '${m}')`),h.setAttribute("x-on:click","removeLens()"),h.setAttribute("data-token","lens");let c=v.parentNode;if(!c)return;if(b){let k=document.createTextNode(b);c.insertBefore(k,v)}if(c.insertBefore(h,v),E){let k=document.createTextNode(E);c.insertBefore(k,v)}else{let k=document.createTextNode(" ");c.insertBefore(k,v)}c.removeChild(v),window.Alpine&&window.Alpine.initTree(h);let d=document.createRange(),x=h.nextSibling;x&&x.nodeType===Node.TEXT_NODE&&(d.setStart(x,0),d.collapse(!0),f.removeAllRanges(),f.addRange(d)),this.syncBufferOnly()},applyOperation(a){u();let l=V(n,a);return n=l.buffer,o(),l.inverse},removeLens(a){if(!t)return;let l=t.querySelector(`[data-token="lens"][data-lens-id="${a}"]`);!l||!l.parentNode||(l.parentNode.removeChild(l),this.syncBufferOnly())},placeCaretAtEnd(){if(!t)return;let a=window.getSelection();if(!a)return;let l=t.lastChild;if(!l)return;let m=document.createRange();l.nodeType===Node.TEXT_NODE?m.setStart(l,l.textContent?.length||0):m.setStartAfter(l),m.collapse(!0),a.removeAllRanges(),a.addRange(m),this.syncBufferOnly()},onInput(a){t&&t.addEventListener("input",()=>{u(),a()})},destroy(){r=null}}}var Q=()=>({queryValue:"",settingsOpen:!1,submitting:!1,mentionOpen:!1,mentionIndex:0,mentionQuery:"",mentionOptions:[],lensOptions:[],idToAtName:{},errorMessage:"",controller:null,showError(e){this.errorMessage=e,setTimeout(()=>this.errorMessage="",5e3)},init(){let e=this.$store.search.query||"",t=this.$store.search.lens_map||{};this.queryValue=e.replace(/^@\S+\s*/,""),this.buildLensState(t),this.controller=K(this.$refs?.editor),this.$watch("queryValue",n=>{this.$store.search.query=n}),this.$watch("$store.search.lens_id",(n,r)=>{let s=this.$refs?.lensSelect;s&&(s.value=n),r!==void 0&&this.controller.removeLens(r),this.syncFromStore(),r!==void 0&&this.controller&&document.activeElement===this.$refs?.editor&&this.controller.placeCaretAtEnd()}),this.$nextTick(()=>{this.syncFromStore(),e||this.$refs?.editor?.focus()})},syncFromStore(){if(!this.controller)return;this.controller.loadFromQuery(this.queryValue,this.getSelectedLens());let e=this.$refs?.textarea;e&&(e.value=this.queryValue)},syncToStore(){if(!this.controller)throw new Error("Buffer controller not initialized");this.controller.syncBufferOnly();let e=this.controller.serialize();if(e!==this.queryValue){this.queryValue=e;let t=this.$refs?.textarea;t&&(t.value=e)}this.updateMentionState()},updateMentionState(){if(!this.controller)return;let e=this.controller.detectMention();if(!e){this.mentionOpen=!1,this.mentionQuery="",this.mentionOptions=this.lensOptions,this.mentionIndex=0;return}let t=e.query,n=this.lensOptions.filter(s=>s.atName.startsWith(t)),r=this.mentionOpen&&this.mentionQuery===t;this.mentionOpen=n.length>0,this.mentionQuery=t,this.mentionOptions=n,this.mentionIndex=r?Math.min(this.mentionIndex,Math.max(n.length-1,0)):0},buildLensState(e){let t=Object.entries(e).map(([r,s])=>({lensId:s,atName:r.toLowerCase()})).filter(r=>r.atName),n=Object.fromEntries(Object.entries(e).map(([r,s])=>[s,r]));this.lensOptions=t,this.mentionOptions=t,this.idToAtName=n},getSelectedLens(){let e=this.$store.search.lens_id||"";if(!e)return null;let t=this.idToAtName[e]||"";return{lensId:e,atName:t}},selectMention(){if(!this.controller||!this.mentionOpen||!this.mentionOptions.length)return;let e=this.controller.detectMention();if(!e)return;let t=this.mentionOptions[this.mentionIndex];t&&(this.controller.insertLensToken(e,t.lensId,t.atName),this.$store.search.lens_id=t.lensId,this.queryValue=this.controller.serialize(),this.mentionOpen=!1,this.mentionQuery="",this.mentionOptions=this.lensOptions,this.mentionIndex=0)},handleEditorKeydown(e){if(!this.mentionOpen){e.key==="Enter"&&(e.preventDefault(),this.submit());return}if(e.key==="ArrowDown"){e.preventDefault();let t=Math.max(this.mentionOptions.length-1,0);this.mentionIndex=Math.min(this.mentionIndex+1,t);return}if(e.key==="ArrowUp"){e.preventDefault(),this.mentionIndex=Math.max(this.mentionIndex-1,0);return}if(e.key==="Enter"||e.key===" "){e.preventDefault(),this.selectMention();return}e.key==="Escape"&&(e.preventDefault(),this.mentionOpen=!1,this.mentionQuery="",this.mentionOptions=this.lensOptions,this.mentionIndex=0)},async submit(){if(this.submitting)return;let e=this.$refs?.form;if(!e)throw new Error("Form ref not found");this.submitting=!0;try{let n=this.$refs?.lensSelect?.value?.trim()||this.$store.search.lens_id||"",r=this.queryValue.trim(),s=Number(this.$store.search.limit);if(!s||s<1)throw new Error("Invalid search limit");let i={q:r,exact:!!this.$store.search.exact,limit:s,lens_id:n||void 0},u=await fetch("/v1/search/fragment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!u.ok)throw new Error(`Search failed (HTTP ${u.status})`);let p=await u.text(),o=document.querySelector("#search-root");if(!o)throw new Error("Page missing #search-root element");o.outerHTML=p;let a=new URLSearchParams;i.q&&a.set("q",i.q),i.exact&&a.set("exact","true"),i.limit&&a.set("limit",String(i.limit)),i.lens_id&&a.set("lens_id",i.lens_id);let l=a.toString()?`${e.action}?${a.toString()}`:e.action;window.history.replaceState({},"",l)}catch(t){let n=t instanceof Error?t.message:String(t);this.showError(`Search failed: ${n}`)}finally{this.submitting=!1}}});var Y=(e,t)=>({lensId:e,rawAtName:t,init(){if(!this.lensId||!this.rawAtName)throw new Error("lensId and rawAtName are required");this.render()},render(){let n=this.$el,r=M(this.rawAtName.toLowerCase());n.className="query-token",n.dataset.token="lens",n.dataset.lensId=this.lensId,n.dataset.atName=r,n.textContent=`@${r}`,n.setAttribute("contenteditable","false"),n.style.cursor="pointer"},removeLens(){this.$store.search.clearLens()}});var z,ye,me,ve;function te(e){return{lang:e?.lang??z?.lang,message:e?.message,abortEarly:e?.abortEarly??z?.abortEarly,abortPipeEarly:e?.abortPipeEarly??z?.abortPipeEarly}}function ge(e){return ye?.get(e)}function ke(e){return me?.get(e)}function xe(e,t){return ve?.get(e)?.get(t)}function ne(e){let t=typeof e;return t==="string"?`"${e}"`:t==="number"||t==="bigint"||t==="boolean"?`${e}`:t==="object"||t==="function"?(e&&Object.getPrototypeOf(e)?.constructor?.name)??"null":t}function S(e,t,n,r,s){let i=s&&"input"in s?s.input:n.value,u=s?.expected??e.expects??null,p=s?.received??ne(i),o={kind:e.kind,type:e.type,input:i,expected:u,received:p,message:`Invalid ${t}: ${u?`Expected ${u} but r`:"R"}eceived ${p}`,requirement:e.requirement,path:s?.path,issues:s?.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly},a=e.kind==="schema",l=s?.message??e.message??xe(e.reference,o.lang)??(a?ke(o.lang):null)??r.message??ge(o.lang);l!==void 0&&(o.message=typeof l=="function"?l(o):l),a&&(n.typed=!1),n.issues?n.issues.push(o):n.issues=[o]}function O(e){return{version:1,vendor:"valibot",validate:t=>e["~run"]({value:t},te())}}function be(e,t){let n=[...new Set(e)];return n.length>1?`(${n.join(` ${t} `)})`:n[0]??"never"}var Ee=/^\d{4}-(?:0[1-9]|1[0-2])-(?:[12]\d|0[1-9]|3[01])[T ](?:0\d|1\d|2[0-3])(?::[0-5]\d){2}(?:\.\d{1,9})?(?:Z|[+-](?:0\d|1\d|2[0-3])(?::?[0-5]\d)?)$/u;function F(e){return{kind:"validation",type:"iso_timestamp",reference:F,async:!1,expects:null,requirement:Ee,message:e,"~run"(t,n){return t.typed&&!this.requirement.test(t.value)&&S(this,"timestamp",t,n),t}}}function we(e,t,n){return typeof e.fallback=="function"?e.fallback(t,n):e.fallback}function se(e,t,n){return typeof e.default=="function"?e.default(t,n):e.default}function B(e,t){return{kind:"schema",type:"array",reference:B,expects:"Array",async:!1,item:e,message:t,get"~standard"(){return O(this)},"~run"(n,r){let s=n.value;if(Array.isArray(s)){n.typed=!0,n.value=[];for(let i=0;i<s.length;i++){let u=s[i],p=this.item["~run"]({value:u},r);if(p.issues){let o={type:"array",origin:"value",input:s,key:i,value:u};for(let a of p.issues)a.path?a.path.unshift(o):a.path=[o],n.issues?.push(a);if(n.issues||(n.issues=p.issues),r.abortEarly){n.typed=!1;break}}p.typed||(n.typed=!1),n.value.push(p.value)}}else S(this,"type",n,r);return n}}}function R(e,t){return{kind:"schema",type:"literal",reference:R,expects:ne(e),async:!1,literal:e,message:t,get"~standard"(){return O(this)},"~run"(n,r){return n.value===this.literal?n.typed=!0:S(this,"type",n,r),n}}}function j(e,t){return{kind:"schema",type:"object",reference:j,expects:"Object",async:!1,entries:e,message:t,get"~standard"(){return O(this)},"~run"(n,r){let s=n.value;if(s&&typeof s=="object"){n.typed=!0,n.value={};for(let i in this.entries){let u=this.entries[i];if(i in s||(u.type==="exact_optional"||u.type==="optional"||u.type==="nullish")&&u.default!==void 0){let p=i in s?s[i]:se(u),o=u["~run"]({value:p},r);if(o.issues){let a={type:"object",origin:"value",input:s,key:i,value:p};for(let l of o.issues)l.path?l.path.unshift(a):l.path=[a],n.issues?.push(l);if(n.issues||(n.issues=o.issues),r.abortEarly){n.typed=!1;break}}o.typed||(n.typed=!1),n.value[i]=o.value}else if(u.fallback!==void 0)n.value[i]=we(u);else if(u.type!=="exact_optional"&&u.type!=="optional"&&u.type!=="nullish"&&(S(this,"key",n,r,{input:void 0,expected:`"${i}"`,path:[{type:"object",origin:"key",input:s,key:i,value:s[i]}]}),r.abortEarly))break}}else S(this,"type",n,r);return n}}}function N(e,t){return{kind:"schema",type:"optional",reference:N,expects:`(${e.expects} | undefined)`,async:!1,wrapped:e,default:t,get"~standard"(){return O(this)},"~run"(n,r){return n.value===void 0&&(this.default!==void 0&&(n.value=se(this,n,r)),n.value===void 0)?(n.typed=!0,n):this.wrapped["~run"](n,r)}}}function T(e){return{kind:"schema",type:"string",reference:T,expects:"string",async:!1,message:e,get"~standard"(){return O(this)},"~run"(t,n){return typeof t.value=="string"?t.typed=!0:S(this,"type",t,n),t}}}function ee(e){let t;if(e)for(let n of e)t?t.push(...n.issues):t=n.issues;return t}function L(e,t){return{kind:"schema",type:"union",reference:L,expects:be(e.map(n=>n.expects),"|"),async:!1,options:e,message:t,get"~standard"(){return O(this)},"~run"(n,r){let s,i,u;for(let p of this.options){let o=p["~run"]({value:n.value},r);if(o.typed){if(!o.issues){s=o;break}i?i.push(o):i=[o]}else u?u.push(o):u=[o]}if(s)return s;if(i){if(i.length===1)return i[0];S(this,"type",n,r,{issues:ee(i)}),n.typed=!0}else{if(u?.length===1)return u[0];S(this,"type",n,r,{issues:ee(u)})}return n}}}function re(...e){return{...e[0],pipe:e,get"~standard"(){return O(this)},"~run"(t,n){for(let r of e)if(r.kind!=="metadata"){if(t.issues&&(r.kind==="schema"||r.kind==="transformation")){t.typed=!1;break}t.issues&&(n.abortEarly||n.abortPipeEarly)||(t=r["~run"](t,n))}return t}}}function ie(e,t,n){let r=e["~run"]({value:t},te(n));return{typed:r.typed,success:!r.issues,output:r.value,issues:r.issues}}var ae=L([R("user"),R("assistant")]),_e=j({type:N(T()),text:N(T())}),Te=N(L([T(),B(_e)])),Ae=j({role:ae,content:Te,model:N(T())}),qe=j({uuid:T(),type:ae,timestamp:re(T(),F()),sessionId:N(T()),message:Ae});function Ie(e,t){return e.map(n=>{let r=n.path?.map(s=>s.key).join(".")||"record";return`Line ${t}: ${r} - ${n.message}`})}function Se(e){return typeof e=="string"?e:Array.isArray(e)?e.map(t=>t.type==="text"&&typeof t.text=="string"?t.text:"").join(`
`):""}function Oe(e){let t=e.split(/\r?\n/),n=new Map,r=50,s={totalLines:t.length,parsed:0,skipped:0,errors:{invalidJSON:[],emptyContent:0,validationErrors:[]}};t.forEach((p,o)=>{let a=o+1;if(!p.trim())return;let l;try{l=JSON.parse(p)}catch(b){s.errors.invalidJSON.length<r&&s.errors.invalidJSON.push(`Line ${a}: ${b.message}`),s.skipped++;return}let m=ie(qe,l);if(!m.success){let b=r-s.errors.validationErrors.length;b>0&&s.errors.validationErrors.push(...Ie(m.issues,a).slice(0,b)),s.skipped++;return}let f=m.output;if(f.message.role!==f.type){s.errors.validationErrors.length<r&&s.errors.validationErrors.push(`Line ${a}: message.role does not match record.type`),s.skipped++;return}let g=Se(f.message.content).trim();if(!g){s.errors.emptyContent++,s.skipped++;return}let v=f.sessionId||`generated_${f.uuid}`;n.has(v)||n.set(v,[]);let y=new Date(f.timestamp);n.get(v).push({uuid:f.uuid,role:f.message.role,content:g,model:f.message.model||null,created_at:Math.floor(y.getTime()/1e3),timestamp:f.timestamp,sessionId:v}),s.parsed++});let i=[];for(let p of n.values()){let o=null;for(let a of p)a.role==="user"?(o&&o.length>0&&i.push(o),o=[a]):a.role==="assistant"&&o&&o.push(a);o&&o.length>0&&i.push(o)}return{threads:i.map((p,o)=>({id:o,threadId:p[0].uuid,userMessage:p[0],assistantMessages:p.slice(1),selected:!1})),report:s}}var oe={name:"Claude Code JSONL",fileExtension:".jsonl",importSource:"claude_code_jsonl",parse:Oe};var Ne={"claude-code":oe},ue=()=>({preview:!1,importing:!1,complete:!1,threads:[],parseReport:null,selectedFormat:"claude-code",banner:{visible:!1,type:"",message:"",timeout:null},get currentValidator(){return Ne[this.selectedFormat]},handleFormatChange(){this.threads=[],this.parseReport=null,this.preview=!1,this.closeBanner(),this.$refs.fileInput&&(this.$refs.fileInput.value="")},showBanner(e,t){this.banner.visible=!0,this.banner.type=e,this.banner.message=t,this.banner.timeout&&clearTimeout(this.banner.timeout),this.banner.timeout=setTimeout(()=>{this.banner.visible=!1},5e3)},closeBanner(){this.banner.visible=!1,this.banner.timeout&&clearTimeout(this.banner.timeout)},get selectedCount(){return this.threads.filter(e=>e.selected).length},get totalMessageCount(){return this.threads.filter(e=>e.selected).reduce((e,t)=>e+1+t.assistantMessages.length,0)},get parseReportSummary(){if(!this.parseReport)return"";let e=this.parseReport,t=[];if(t.push(`${e.parsed} records parsed`),e.skipped>0){let n=[];e.errors.invalidJSON.length>0&&n.push(`${e.errors.invalidJSON.length} invalid JSON`),e.errors.emptyContent>0&&n.push(`${e.errors.emptyContent} empty content`),e.errors.validationErrors.length>0&&n.push(`${e.errors.validationErrors.length} validation errors`),t.push(`${e.skipped} skipped: ${n.join(", ")}`)}return t.join(", ")},handleFileSelect(e){let t=e.target.files?.[0];if(!t)return;let n=new FileReader;n.onload=r=>{try{let s=r.target.result,{threads:i,report:u}=this.currentValidator.parse(s);this.threads=i,this.parseReport=u,this.preview=!0,u.skipped>0&&this.showBanner("error",this.parseReportSummary)}catch(s){console.error("Parse error:",s),this.showBanner("error",`Failed to parse file: ${s.message}`)}},n.readAsText(t)},toggleAll(){let e=this.threads.every(t=>t.selected);this.threads.forEach(t=>t.selected=!e)},cancelImport(){this.preview=!1,this.threads=[],this.parseReport=null,this.closeBanner(),this.$refs.fileInput.value=""},async executeImport(){if(!(this.importing||this.selectedCount===0)){this.importing=!0;try{let e=[];for(let s of this.threads.filter(i=>i.selected)){e.push({thread_id:s.threadId,role:s.userMessage.role,content:s.userMessage.content,model:s.userMessage.model,created_at:s.userMessage.created_at,import_external_id:s.userMessage.uuid,meta:{imported_external_id:s.userMessage.uuid,imported_external_session_id:s.userMessage.sessionId,imported_external_created_at:s.userMessage.timestamp}});for(let i of s.assistantMessages)e.push({thread_id:s.threadId,role:i.role,content:i.content,model:i.model,created_at:i.created_at,import_external_id:i.uuid,meta:{imported_external_id:i.uuid,imported_external_session_id:i.sessionId,imported_external_created_at:i.timestamp}})}let t=await fetch("/v1/import/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({import_source:this.currentValidator.importSource,messages:e})});if(!t.ok)throw new Error("Could not import records.");let n=await t.json();this.preview=!1,this.complete=!0;let r=n.skipped_duplicates>0?`Imported ${n.imported} messages (skipped ${n.skipped_duplicates} duplicates)`:`Successfully imported ${n.imported} messages`;this.showBanner("success",r)}catch(e){console.error("Import error:",e),this.showBanner("error",`Failed to import: ${e.message}`),this.importing=!1}}}});var le=()=>({pending:!1,assistantEventSource:null,jobPollTimeout:null,jobPollAttempt:0,createPlaceholder(e){let t=this.$refs.placeholderTemplate.content.cloneNode(!0),n=t.querySelector(".message");return n.dataset.tempId=e,t},parseHtmlElement(e){let t=document.createElement("template");return t.innerHTML=String(e).trim(),t.content.firstElementChild},cleanupAssistantStream(){this.assistantEventSource&&this.assistantEventSource.close(),this.assistantEventSource=null},cleanupJobPoll(){this.jobPollTimeout&&clearTimeout(this.jobPollTimeout),this.jobPollTimeout=null,this.jobPollAttempt=0},async pollJobStatus(e,t){try{let n=await fetch(`/v1/threads/${e}/activity`,{headers:{Accept:"application/json"}});if(!n.ok)return;if((await n.json())?.job_events?.[0]?.status==="failed"){let u=this.$refs.responses.querySelector(`[data-temp-id="${t}"]`);u&&u.remove(),this.cleanupJobPoll();return}this.jobPollAttempt+=1;let i=Math.min(1e3*Math.pow(2,this.jobPollAttempt),3e4);this.jobPollTimeout=setTimeout(()=>this.pollJobStatus(e,t),i)}catch(n){console.error("Error polling job status:",n),this.jobPollAttempt+=1;let r=Math.min(1e3*Math.pow(2,this.jobPollAttempt),3e4);this.jobPollTimeout=setTimeout(()=>this.pollJobStatus(e,t),r)}},startEventStreams(e,t,{afterAssistantUuid:n=null}={}){if(this.assistantEventSource)return;let r=new URL(`/v1/threads/${e}/stream`,window.location.origin);r.searchParams.set("role","assistant"),n&&r.searchParams.set("after_uuid",n),this.assistantEventSource=new EventSource(r),this.assistantEventSource.addEventListener("assistant",async s=>{try{let u=JSON.parse(s?.data||"{}")?.uuid;if(!u)return;let p=await fetch(`/v1/messages/${u}/fragment`,{headers:{Accept:"text/html"}});if(!p.ok)return;let o=await p.text(),a=this.parseHtmlElement(o),l=this.$refs.responses.querySelector(`[data-temp-id="${t}"]`);l&&a&&l.replaceWith(a),this.cleanupJobPoll()}finally{this.cleanupAssistantStream()}}),this.assistantEventSource.addEventListener("error",()=>this.cleanupAssistantStream()),this.jobPollAttempt=0,this.pollJobStatus(e,t)},init(){if(!this.$refs.responses||this.$refs.responses.children.length)return;let e=this.$el?.dataset?.threadId;if(!e)return;let t="initial",n=this.createPlaceholder(t);this.$refs.responses.prepend(n),this.startEventStreams(e,t)},async regenerate(e){if(this.pending)return;let t=e?.currentTarget,n=t?.dataset?.threadId,r=t?.dataset?.model,s=t?.dataset?.promptContent;if(!n||!s)return;this.pending=!0;let i=Math.random().toString(36).slice(2,10),u=this.createPlaceholder(i);this.$refs.responses.prepend(u);try{let o=this.$refs.responses.querySelector(".message[data-uuid]")?.dataset?.uuid||null,a=await fetch("/v1/ask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:s,thread_id:n,lens_id:this.$refs?.lensSelect?.value||void 0,model:r})});if(!a.ok)throw new Error(`Ask HTTP ${a.status}`);this.startEventStreams(n,i,{afterAssistantUuid:o})}catch(p){console.error("Error:",p);let o=this.$refs.responses.querySelector(`[data-temp-id="${i}"]`);o&&o.remove()}finally{this.pending=!1}}});var ce=()=>({}),pe=e=>({open(){this.$store.threads.setCurrentThread(e),this.$refs.popover.showPopover()},close(){this.$refs.popover.hidePopover(),this.$store.threads.clearCurrentThread()},get isDeleting(){return this.$store.threads.isDeleting(e)},async confirmDelete(){this.$store.threads.setDeleting(!0);try{let t=await fetch(`/v1/threads/${e}`,{method:"DELETE"});if(!t.ok){let n=await t.json().catch(()=>({}));throw new Error(n.detail||`HTTP ${t.status}`)}window.location.reload()}catch(t){console.error("Delete error:",t),alert(`Failed to delete thread: ${t.message}`),this.$store.threads.setDeleting(!1)}}});function de(e,t){if(typeof e!="string")throw new TypeError("highlightCode expects a string");let n=je(e,t),r=[],s=[],i=[],u=[],p=[],o=c=>{if(!Number.isInteger(c)||c<0)throw new TypeError("encodeIndex expects a non-negative integer");let d="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",x=d.length,k=c,$="";do $=d[k%x]+$,k=Math.floor(k/x);while(k>0);return $},a=c=>`HLSTR${o(c)}`,l=c=>`HLCMT${o(c)}`,m=c=>`HLKW${o(c)}`,f=c=>`HLBI${o(c)}`,g=c=>`HLNUM${o(c)}`,v=c=>{let d="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",x=d.length,k=0;for(let $ of String(c)){let w=d.indexOf($);if(w===-1)throw new Error("Invalid placeholder encoding");k=k*x+w}return k},y=e;n==="python"?(y=y.replace(/#[^\n]*/g,c=>{let d=s.length;return s.push(c),l(d)}),y=y.replace(/'''[\s\S]*?'''|"""[\s\S]*?"""/g,c=>{let d=r.length;return r.push(c),a(d)}),y=y.replace(/'([^'\\]|\\.)*?'|"([^"\\]|\\.)*?"/g,c=>{let d=r.length;return r.push(c),a(d)})):n==="sql"?(y=y.replace(/--[^\n]*/g,c=>{let d=s.length;return s.push(c),l(d)}),y=y.replace(/'([^'\\]|\\.)*?'/g,c=>{let d=r.length;return r.push(c),a(d)})):(y=y.replace(/\/\/[^\n]*/g,c=>{let d=s.length;return s.push(c),l(d)}),y=y.replace(/\/\*[\s\S]*?\*\//g,c=>{let d=s.length;return s.push(c),l(d)}),y=y.replace(/'([^'\\]|\\.)*?'|"([^"\\]|\\.)*?"|`([^`\\]|\\.)*?`/g,c=>{let d=r.length;return r.push(c),a(d)})),y=J(y);let b=c=>c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),E=Ce(n);if(E.length>0){let c=n==="sql"?"gi":"g",d=new RegExp(`\\b(${E.map(b).join("|")})\\b`,c);y=y.replace(d,x=>{let k=i.length;return i.push(x),m(k)})}let h=Me(n);if(h.length>0){let c=n==="sql"?"gi":"g",d=new RegExp(`\\b(${h.map(b).join("|")})\\b`,c);y=y.replace(d,x=>{let k=u.length;return u.push(x),f(k)})}return y=y.replace(/\b\d+(\.\d+)?\b/g,c=>{let d=p.length;return p.push(c),g(d)}),y=y.replace(/\u0001HLSTR([A-Za-z]+)\u0001/g,(c,d)=>{let x=v(d),k=r[x];if(k===void 0)throw new Error("Invalid string placeholder index");return`<span class="hl-str">${J(k)}</span>`}),y=y.replace(/\u0001HLCMT([A-Za-z]+)\u0001/g,(c,d)=>{let x=v(d),k=s[x];if(k===void 0)throw new Error("Invalid comment placeholder index");return`<span class="hl-cmt">${J(k)}</span>`}),y=y.replace(/\u0001HLNUM([A-Za-z]+)\u0001/g,(c,d)=>{let x=v(d),k=p[x];if(k===void 0)throw new Error("Invalid number placeholder index");return`<span class="hl-num">${k}</span>`}),y=y.replace(/\u0001HLBI([A-Za-z]+)\u0001/g,(c,d)=>{let x=v(d),k=u[x];if(k===void 0)throw new Error("Invalid builtin placeholder index");return`<span class="hl-bi">${k}</span>`}),y=y.replace(/\u0001HLKW([A-Za-z]+)\u0001/g,(c,d)=>{let x=v(d),k=i[x];if(k===void 0)throw new Error("Invalid keyword placeholder index");return`<span class="hl-kw">${k}</span>`}),y}function J(e){if(typeof e!="string")throw new TypeError("escapeHtml expects a string");return e.replace(/[&<>"']/g,t=>t==="&"?"&amp;":t==="<"?"&lt;":t===">"?"&gt;":t==='"'?"&quot;":"&apos;")}function je(e,t){if(t){let n=t.toLowerCase();return n==="js"||n==="javascript"||n==="typescript"||n==="ts"?"javascript":n==="py"||n==="python"?"python":n==="sql"||n==="postgres"||n==="postgresql"||n==="mysql"?"sql":n==="go"||n==="golang"?"go":n==="rs"||n==="rust"?"rust":n==="sh"||n==="bash"||n==="shell"?"shell":n}return/\b(def|class)\s+\w+[\(:]/.test(e)?"python":/\b(const|let|var|function)\s+\w+/.test(e)?"javascript":/^\s*(SELECT|INSERT|UPDATE|DELETE|CREATE|ALTER|DROP)\b/mi.test(e)?"sql":/\bfn\s+\w+\(/.test(e)?"rust":/\bfunc\s+\w+\(/.test(e)?"go":"generic"}function Ce(e){let t={python:["def","class","if","else","elif","for","while","return","import","from","as","try","except","finally","with","lambda","yield","async","await","raise","pass","break","continue","in","is","not","and","or"],javascript:["function","const","let","var","if","else","for","while","return","import","export","default","class","extends","async","await","yield","typeof","new","delete","this","super","static","try","catch","finally","throw","break","continue","switch","case"],sql:["SELECT","FROM","WHERE","JOIN","INNER","LEFT","RIGHT","OUTER","ON","INSERT","INTO","VALUES","UPDATE","SET","DELETE","CREATE","TABLE","ALTER","DROP","INDEX","ORDER","BY","GROUP","HAVING","LIMIT","OFFSET","AS","AND","OR","NOT","IN","LIKE","BETWEEN"],go:["func","package","import","var","const","type","struct","interface","if","else","for","range","return","defer","go","chan","select","case","switch","break","continue"],rust:["fn","let","mut","const","static","struct","enum","impl","trait","type","if","else","match","for","while","loop","return","break","continue","use","mod","pub","crate"],shell:["if","then","else","elif","fi","for","while","do","done","case","esac","function","return","exit","export","source"],generic:[]};return t[e]||t.generic}function Me(e){let t={python:["True","False","None","self","str","int","float","bool","list","dict","tuple","set","len","range","print","open","type","isinstance","super","__init__","__name__"],javascript:["true","false","null","undefined","NaN","Infinity","console","window","document","Array","Object","String","Number","Boolean","Math","Date","Promise","JSON"],sql:["NULL","TRUE","FALSE","COUNT","SUM","AVG","MIN","MAX","DISTINCT","EXISTS"],go:["true","false","nil","make","new","len","cap","append","copy","delete","panic","recover"],rust:["true","false","None","Some","Ok","Err","Vec","String","Option","Result","println","panic"],shell:["echo","cd","ls","pwd","cat","grep","sed","awk","find","chmod","chown"],generic:["true","false","null","undefined"]};return t[e]||t.generic}function A(e){if(typeof e!="string")throw new TypeError("escapeHtml expects a string");return e.replace(/[&<>"']/g,t=>t==="&"?"&amp;":t==="<"?"&lt;":t===">"?"&gt;":t==='"'?"&quot;":"&#39;")}function C(e){if(typeof e!="string")throw new TypeError("parseInline expects a string");let t=[],n=[],r=[],s=p=>`ROSECODE${p}`,i=p=>`ROSELINK${p}`,u=p=>`ROSEAUTOLINK${p}`;return e=e.replace(/`([^`]*?)`/g,(p,o)=>{let a=t.length;return t.push(A(o)),s(a)}),e=e.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(p,o,a)=>{let l=a.trim();if(!(/^(https?|mailto|tel):/i.test(l)||/^[/.#]/.test(l)))return o;let f=n.length,g=A(o),v=A(l);return n.push(`<a href="${v}" target="_blank" rel="noopener noreferrer">${g}</a>`),i(f)}),e=e.replace(/\bhttps?:\/\/[^\s<>"']+/g,p=>{let o=p,a="";for(;/[),.;:!?\\\]]$/.test(o);)a=o.slice(-1)+a,o=o.slice(0,-1);if(!o)return A(p);let l=r.length,m=A(o);return r.push(`<a href="${m}" target="_blank" rel="noopener noreferrer">${m}</a>${A(a)}`),u(l)}),e=A(e),e=e.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),e=e.replace(/__([^_]+)__/g,"<strong>$1</strong>"),e=e.replace(/\*([^*]+)\*/g,"<em>$1</em>"),e=e.replace(/_([^_]+)_/g,"<em>$1</em>"),e=e.replace(/\u0001ROSELINK(\d+)\u0001/g,(p,o)=>{let a=n[Number(o)];if(a===void 0)throw new Error("Invalid link placeholder index");return a}),e=e.replace(/\u0001ROSEAUTOLINK(\d+)\u0001/g,(p,o)=>{let a=r[Number(o)];if(a===void 0)throw new Error("Invalid auto-link placeholder index");return a}),e=e.replace(/\u0001ROSECODE(\d+)\u0001/g,(p,o)=>{let a=t[Number(o)];if(a===void 0)throw new Error("Invalid code placeholder index");return`<code>${a}</code>`}),e}function fe(e){if(typeof e!="string")throw new TypeError("markdownToHtml expects a string");let t=1e5;if(e.length>t){let b=e.slice(0,t),E=`<div class="markdown-error">Content exceeds ${t} characters, showing truncated...`;return E+=`</div><pre>${A(b)}</pre>`,E}e=e.replace(/\r\n?/g,`
`);let n=e.split(`
`),r="",s=!1,i=!1,u=!1,p=!1,o=[],a=[],l="",m=[];function f(){o.length>0&&(r+=`<p>${C(o.join(" "))}</p>
`,o=[])}function g(){u&&(r+=`<blockquote>${a.join(`<br />
`)}</blockquote>
`,a=[],u=!1)}function v(){if(!p)return;let b=m.join(`
`),E=l?` class="language-${A(l)}"`:"",h=de(b,l);r+=`<pre><code${E}>${h}</code></pre>
`,l="",m=[],p=!1}function y(){s&&(r+=`</ul>
`,s=!1),i&&(r+=`</ol>
`,i=!1)}for(let b=0;b<n.length;b++){let E=n[b],h=E.match(/^```([^\s`]+)?\s*$/);if(h){f(),y(),g(),p?v():(p=!0,l=(h[1]||"").trim(),m=[]);continue}if(p){m.push(E);continue}if(!E.trim()){f(),y(),g();continue}if(/^(\-\-\-|\*\*\*|___)\s*$/.test(E.trim())){f(),y(),g(),r+=`<hr />
`;continue}if(/^\s*>\s?/.test(E)){f(),y(),u||(u=!0);let k=E.replace(/^\s*>\s?/,"");a.push(C(k));continue}let c=E.match(/^(#{1,6})\s+(.*)$/);if(c){f(),y(),g();let k=c[1].length,$=c[2].trim();r+=`<h${k}>${C($)}</h${k}>
`;continue}let d=E.match(/^\s*(\d+)\.\s+(.*)$/);if(d){f(),g(),s&&(r+=`</ul>
`,s=!1),i||(r+=`<ol>
`,i=!0),r+=`<li>${C(d[2])}</li>
`;continue}let x=E.match(/^\s*[-*+]\s+(.*)$/);if(x){f(),g(),i&&(r+=`</ol>
`,i=!1),s||(r+=`<ul>
`,s=!0),r+=`<li>${C(x[1])}</li>
`;continue}g(),y(),o.push(E)}return v(),f(),y(),g(),r.trim()}document.addEventListener("alpine:init",()=>{if(!window.TRANSPORT?.search)throw new Error("TRANSPORT.search not found");Alpine.store("search",{...window.TRANSPORT.search,clearLens(){this.lens_id=""}}),Alpine.store("threads",{...window.TRANSPORT.threads,setCurrentThread(e){this.currentThreadId=e},clearCurrentThread(){this.currentThreadId=null},setDeleting(e){this.deleting=e},isDeleting(e){return this.deleting&&this.currentThreadId===e}}),Alpine.magic("markdown",()=>fe),Alpine.data("askButton",G),Alpine.data("responseMessage",X),Alpine.data("searchForm",Q),Alpine.data("lensToken",Y),Alpine.data("importPage",ue),Alpine.data("threadMessagesPage",le),Alpine.data("threadsListPage",ce),Alpine.data("deleteConfirmPopover",pe)});})();
