(()=>{var b=()=>({disabled:!1,label:"Ask",async ask(){let t=this.$el.closest("form")?.querySelector('[name="q"]:not([disabled])')?.value?.trim()||"";if(!(!t||this.disabled)){this.disabled=!0;try{let a=this.$el.closest("form")?.querySelector('select[name="lens_id"]')?.value?.trim()||"",i=await(await fetch("/v1/ask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:t,lens_id:a||void 0})})).json();if(!i?.thread_id)throw new Error("Missing thread_id");let l=a?`?lens_id=${encodeURIComponent(a)}`:"";window.location.href="/v1/threads/"+i.thread_id+l}catch(e){alert("Error: "+(e?.message||String(e)))}finally{this.disabled=!1}}}});var M=()=>({uuid:null,accepted:!1,collapsed:!1,expanded:!1,editing:!1,draft:"",original:"",editable:!1,saving:!1,init(){this.uuid=this.$el.dataset.uuid,this.accepted=this.$el.classList.contains("accepted");let t=this.$refs?.sourceContent;if(this.editable=!!t,!this.editable)return;let e=t.content?.textContent;this.original=(e??this.$el.querySelector(".message-content")?.innerText??"").trimEnd(),this.draft=this.original},startEdit(){this.editable&&(this.editing=!0,this.draft=this.original,this.$nextTick(()=>this.$refs?.editor?.focus()))},cancelEdit(){this.editable&&(this.editing=!1,this.draft=this.original)},async saveEdit(){if(!(!this.editable||this.saving)){this.saving=!0;try{let t=await fetch(`/v1/messages/${this.uuid}/revisions`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({content:this.draft})});if(!t.ok)throw new Error(`HTTP ${t.status}`);window.location.reload()}catch(t){console.error("Error:",t),this.saving=!1}}},async toggleAccepted(){try{let t=await fetch(`/v1/messages/${this.uuid}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({accepted:!this.accepted})});if(!t.ok)throw new Error(`HTTP ${t.status}`);this.accepted=!this.accepted}catch(t){console.error("Error:",t)}}});function S(t){let e=[];for(let n of t)if(n.type==="text")if(e.length>0&&e[e.length-1].type==="text"){let a=e[e.length-1];a.value+=n.value}else e.push({type:"text",value:n.value});else e.push(n);return(e.length===0||e[e.length-1].type!=="text")&&e.push({type:"text",value:""}),e}function _(t){let e=[];for(let n of t)n.type==="text"&&n.value&&e.push(n.value);return e.join("")}function $(t,e=[]){let n=[];for(let a of e)n.push({type:"lens",lensId:a.lensId,atName:a.atName});return t&&n.push({type:"text",value:t}),S(n)}function N(t,e){let n=Math.max(0,Math.min(e.tokenIndex,t.length-1)),a=t[n],s=a.type==="text"?a.value.length:0,i=Math.max(0,Math.min(e.offset,s));return{tokenIndex:n,offset:i}}function R(t,e){let{tokens:n,caret:a}=t;if(e.type==="insertText"){let{at:s,text:i}=e,l=[...n],m=l[s.tokenIndex];if(m.type!=="text")throw new Error("Cannot insert text into non-text token");let u=m.value.slice(0,s.offset),o=m.value.slice(s.offset);l[s.tokenIndex]={type:"text",value:u+i+o};let r=S(l),d={tokenIndex:s.tokenIndex,offset:s.offset+i.length},h=N(r,d),x={type:"deleteRange",from:s,to:{tokenIndex:s.tokenIndex,offset:s.offset+i.length}};return{buffer:{tokens:r,caret:h},inverse:x}}if(e.type==="deleteRange"){let{from:s,to:i}=e,l=[...n],m=[];if(s.tokenIndex===i.tokenIndex){let f=l[s.tokenIndex];if(f.type!=="text")throw new Error("Cannot delete from non-text token");let y=f.value.slice(0,s.offset),k=f.value.slice(s.offset,i.offset),w=f.value.slice(i.offset);l[s.tokenIndex]={type:"text",value:y+w};let O=S(l),E={tokenIndex:s.tokenIndex,offset:s.offset},I=N(O,E);return{buffer:{tokens:O,caret:I},inverse:{type:"insertText",at:s,text:k}}}let u=l[s.tokenIndex],o=l[i.tokenIndex];if(u.type!=="text"||o.type!=="text")throw new Error("Cross-token delete requires text tokens at boundaries");let r=u.value.slice(0,s.offset),d=u.value.slice(s.offset),h=o.value.slice(0,i.offset),x=o.value.slice(i.offset);for(let f=s.tokenIndex;f<=i.tokenIndex;f++)m.push(l[f]);m[0]={type:"text",value:d},m[m.length-1]={type:"text",value:h};let p=[];for(let f=0;f<m.length;f++){let y=m[f];if(y.type==="text")if(p.length>0&&p[p.length-1].type==="text"){let k=p[p.length-1];p[p.length-1]={type:"text",value:k.value+y.value}}else p.push(y);else p.push(y)}for(let f=i.tokenIndex;f>=s.tokenIndex;f--)l.splice(f,1);l.splice(s.tokenIndex,0,{type:"text",value:r+x});let T=S(l),g={tokenIndex:s.tokenIndex,offset:s.offset},v=N(T,g);return{buffer:{tokens:T,caret:v},inverse:{type:"insertTokens",at:s,tokens:p}}}if(e.type==="replaceToken"){let{index:s,token:i}=e,l=[...n],m=l[s];l[s]=i;let u=S(l),o=N(u,a);return{buffer:{tokens:u,caret:o},inverse:{type:"replaceToken",index:s,token:m}}}if(e.type==="insertTokens"){let{at:s,tokens:i}=e,l=[...n],m=l[s.tokenIndex];if(m.type!=="text")throw new Error("Cannot insert tokens into non-text token");let u=m.value.slice(0,s.offset),o=m.value.slice(s.offset),r=[...i];if(r.length>0){let c=r[0];c.type==="text"?r[0]={type:"text",value:u+c.value}:u&&r.unshift({type:"text",value:u});let f=r[r.length-1];f.type==="text"?r[r.length-1]={type:"text",value:f.value+o}:o&&r.push({type:"text",value:o})}else r.push({type:"text",value:u+o});l.splice(s.tokenIndex,1,...r);let d=S(l),h=i[i.length-1],x=0,p=0;if(h&&h.type!=="text"){let c=0;for(let E=0;E<s.tokenIndex;E++){let I=n[E];I.type==="text"&&(c+=I.value.length)}c+=s.offset;let f=c;for(let E of i)E.type==="text"&&(f+=E.value.length);let y=0;for(let E of i)E.type!=="text"&&y++;let k=0,w=0,O=!1;for(let E=0;E<d.length;E++){let I=d[E];if(I.type==="text"){if(!O&&k>=c&&(O=!0),f<=k+I.value.length){x=E,p=f-k;break}k+=I.value.length}else if(O&&(w++,w===y)){x=E+1,p=0;break}}}else{let c=u.length;for(let y of i)y.type==="text"&&(c+=y.value.length);let f=0;for(let y=0;y<d.length;y++){let k=d[y];if(k.type==="text"){if(c<=f+k.value.length){x=y,p=c-f;break}f+=k.value.length}}}let g=N(d,{tokenIndex:x,offset:p});return{buffer:{tokens:d,caret:g},inverse:{type:"deleteRange",from:s,to:g}}}throw new Error(`Unknown op type: ${e.type}`)}function C(t){let e=document.createElement("div");return e.textContent=t||"",e.textContent||""}function q(t,e){e.textContent="";let n=new Map,a=0;for(let s=0;s<t.length;s++){let i=t[s];if(i.type==="lens"){let l=document.createElement("span");l.setAttribute("x-data",`lensToken('${i.lensId}', '${i.atName}')`),l.setAttribute("x-on:click","removeLens()"),l.setAttribute("data-token","lens"),e.appendChild(l),n.set(s,{node:l,textStart:a,textEnd:a})}else if(i.type==="text"){let l=document.createTextNode(C(i.value));e.appendChild(l),n.set(s,{node:l,textStart:a,textEnd:a+i.value.length}),a+=i.value.length}}return n}function P(t,e,n){let a=e.get(t.tokenIndex);if(!a)return null;if(a.node.nodeType===Node.TEXT_NODE)return{node:a.node,offset:t.offset};if(t.offset===0)return{node:n,offset:Array.from(n.childNodes).indexOf(a.node)};let s=t.tokenIndex+1,i=e.get(s);return i?{node:n,offset:Array.from(n.childNodes).indexOf(i.node)}:{node:n,offset:n.childNodes.length}}function A(t,e,n,a){for(let[s,i]of n.entries())if(i.node===t)return t.nodeType===Node.TEXT_NODE?{tokenIndex:s,offset:Math.min(e,i.textEnd-i.textStart)}:{tokenIndex:s,offset:0};if(t===a){let s=Array.from(a.childNodes);if(e>=s.length){let l=n.size-1,m=n.get(l);return m&&m.node.nodeType===Node.TEXT_NODE?{tokenIndex:l,offset:m.textEnd-m.textStart}:{tokenIndex:l,offset:0}}let i=s[e];for(let[l,m]of n.entries())if(m.node===i)return{tokenIndex:l,offset:0}}return{tokenIndex:n.size-1,offset:0}}var H=/(?:^|[^A-Za-z0-9-])@([A-Za-z0-9-]*)/g;function L(t,e){let n="",a=[],s=0,i=-1;for(let h=0;h<t.length;h++){let x=t[h];if(x.type==="text"){let p=n.length;n+=x.value,a.push({tokenIndex:h,startChar:p,endChar:n.length}),h<e.tokenIndex?s+=x.value.length:h===e.tokenIndex&&(s+=e.offset,i=a.length-1)}else a.push({tokenIndex:h,startChar:n.length,endChar:n.length}),h<e.tokenIndex&&(i=a.length-1)}if(i===-1||n.length===0)return null;let l=n.slice(0,s),m=Array.from(l.matchAll(H));if(m.length===0)return null;let u=m[m.length-1],o=u[0].startsWith("@")?0:1,r=u.index+o,d=r+u[0].length-o;if(d!==s)return null;for(let h of a)if(r>=h.startChar&&r<h.endChar)return d>h.endChar?null:{tokenIndex:h.tokenIndex,startOffset:r-h.startChar,endOffset:d-h.startChar,query:u[1].toLowerCase(),raw:u[0].slice(o)};return null}function z(t){let e=t,n={tokens:$(""),caret:{tokenIndex:0,offset:0}},a=null,s=!1,i=()=>{if(!e||!a||document.activeElement!==e)return;let o=P(n.caret,a,e);if(!o)return;let r=window.getSelection();if(!r)return;let d=document.createRange();d.setStart(o.node,o.offset),d.collapse(!0),r.removeAllRanges(),r.addRange(d)},l=()=>{if(!e||!a)return;let o=window.getSelection();if(!o||!o.rangeCount)return;let r=o.getRangeAt(0);n.caret=A(r.startContainer,r.startOffset,a,e)},m=()=>{if(!e)return;let o=[],r=new Map,d=0,h=0,x=!1;for(let c of e.childNodes){if(c.nodeType===Node.ELEMENT_NODE&&c.dataset?.token==="lens"){o.push({type:"lens",lensId:c.dataset.lensId,atName:c.dataset.atName}),r.set(h++,{node:c,textStart:d,textEnd:d});continue}if(c.nodeType===Node.TEXT_NODE){let f=c.textContent||"";o.push({type:"text",value:f}),r.set(h++,{node:c,textStart:d,textEnd:d+f.length}),d+=f.length;continue}c.nodeType===Node.ELEMENT_NODE&&c.tagName==="BR"&&(x=!0)}let p=o.some((c,f)=>c.type==="text"&&f>0&&o[f-1].type==="text"),T=o.length>0&&o[o.length-1].type==="lens";(p||T||x)&&(x=!0);let g=n.caret,v=window.getSelection();if(v&&v.rangeCount){let c=v.getRangeAt(0);g=A(c.startContainer,c.startOffset,r,e)}if(x){let c=S(o);g=N(c,g),n={tokens:c,caret:g},u()}else{let c=S(o);g=N(c,g),n={tokens:c,caret:g},a=r}},u=()=>{if(!(!e||s)){s=!0;try{a=q(n.tokens,e),i(),window.Alpine&&window.Alpine.initTree(e)}finally{s=!1}}};return{getBuffer(){return n},setBuffer(o){n=o,u()},loadFromQuery(o,r){let d=[];r?.lensId&&r?.atName&&d.push({lensId:r.lensId,atName:r.atName});let h=$(o,d),x=h.length-1,p=h[x];n={tokens:h,caret:{tokenIndex:x,offset:p?.type==="text"?p.value.length:0}},u()},syncFromDOM(){m()},syncBufferOnly(){if(!e)return;let o=[],r=new Map,d=0,h=0;for(let c of e.childNodes)if(c.nodeType===Node.ELEMENT_NODE&&c.dataset?.token==="lens")o.push({type:"lens",lensId:c.dataset.lensId,atName:c.dataset.atName}),r.set(h++,{node:c,textStart:d,textEnd:d});else if(c.nodeType===Node.TEXT_NODE){let f=c.textContent||"";o.push({type:"text",value:f}),r.set(h++,{node:c,textStart:d,textEnd:d+f.length}),d+=f.length}o.length===0&&(o.push({type:"text",value:""}),r.set(0,{node:null,textStart:0,textEnd:0}));let x=window.getSelection(),p={tokenIndex:0,offset:0};if(x&&x.rangeCount){let c=x.getRangeAt(0);p=A(c.startContainer,c.startOffset,r,e)}let T=o.length-1;p.tokenIndex=Math.max(0,Math.min(p.tokenIndex,T));let g=o[p.tokenIndex],v=g?.type==="text"?g.value.length:0;p.offset=Math.max(0,Math.min(p.offset,v)),n={tokens:o,caret:p},a=r},serialize(){return _(n.tokens)},detectMention(){return L(n.tokens,n.caret)},insertLensToken(o,r,d){if(!e)return;let h=window.getSelection();if(!h||!h.rangeCount)return;let x=a.get(o.tokenIndex);if(!x||!x.node)return;let p=x.node,T=p.textContent||"",g=T.slice(0,o.startOffset),v=T.slice(o.endOffset),c=document.createElement("span");c.setAttribute("x-data",`lensToken('${r}', '${d}')`),c.setAttribute("x-on:click","removeLens()"),c.setAttribute("data-token","lens");let f=p.parentNode;if(!f)return;if(g){let w=document.createTextNode(g);f.insertBefore(w,p)}if(f.insertBefore(c,p),v){let w=document.createTextNode(v);f.insertBefore(w,p)}else{let w=document.createTextNode(" ");f.insertBefore(w,p)}f.removeChild(p),window.Alpine&&window.Alpine.initTree(c);let y=document.createRange(),k=c.nextSibling;k&&k.nodeType===Node.TEXT_NODE&&(y.setStart(k,0),y.collapse(!0),h.removeAllRanges(),h.addRange(y)),this.syncBufferOnly()},applyOperation(o){l();let r=R(n,o);return n=r.buffer,u(),r.inverse},removeLens(o){if(!e)return;let r=e.querySelector(`[data-token="lens"][data-lens-id="${o}"]`);!r||!r.parentNode||(r.parentNode.removeChild(r),this.syncBufferOnly())},placeCaretAtEnd(){if(!e)return;let o=window.getSelection();if(!o)return;let r=e.lastChild;if(!r)return;let d=document.createRange();r.nodeType===Node.TEXT_NODE?d.setStart(r,r.textContent?.length||0):d.setStartAfter(r),d.collapse(!0),o.removeAllRanges(),o.addRange(d),this.syncBufferOnly()},onInput(o){e&&e.addEventListener("input",()=>{l(),o()})},destroy(){a=null}}}var B=()=>({queryValue:"",settingsOpen:!1,submitting:!1,mentionOpen:!1,mentionIndex:0,mentionQuery:"",mentionOptions:[],lensOptions:[],idToAtName:{},errorMessage:"",controller:null,showError(t){this.errorMessage=t,setTimeout(()=>this.errorMessage="",5e3)},init(){let t=this.$store.search.query||"",e=this.$store.search.lens_map||{};this.queryValue=t.replace(/^@\S+\s*/,""),this.buildLensState(e),this.controller=z(this.$refs?.editor),this.$watch("queryValue",n=>{this.$store.search.query=n}),this.$watch("$store.search.lens_id",(n,a)=>{let s=this.$refs?.lensSelect;s&&(s.value=n),a!==void 0&&this.controller.removeLens(a),this.syncFromStore(),a!==void 0&&this.controller&&document.activeElement===this.$refs?.editor&&this.controller.placeCaretAtEnd()}),this.$nextTick(()=>{this.syncFromStore(),t||this.$refs?.editor?.focus()})},syncFromStore(){if(!this.controller)return;this.controller.loadFromQuery(this.queryValue,this.getSelectedLens());let t=this.$refs?.textarea;t&&(t.value=this.queryValue)},syncToStore(){if(!this.controller)throw new Error("Buffer controller not initialized");this.controller.syncBufferOnly();let t=this.controller.serialize();if(t!==this.queryValue){this.queryValue=t;let e=this.$refs?.textarea;e&&(e.value=t)}this.updateMentionState()},updateMentionState(){if(!this.controller)return;let t=this.controller.detectMention();if(!t){this.mentionOpen=!1,this.mentionQuery="",this.mentionOptions=this.lensOptions,this.mentionIndex=0;return}let e=t.query,n=this.lensOptions.filter(s=>s.atName.startsWith(e)),a=this.mentionOpen&&this.mentionQuery===e;this.mentionOpen=n.length>0,this.mentionQuery=e,this.mentionOptions=n,this.mentionIndex=a?Math.min(this.mentionIndex,Math.max(n.length-1,0)):0},buildLensState(t){let e=Object.entries(t).map(([a,s])=>({lensId:s,atName:a.toLowerCase()})).filter(a=>a.atName),n=Object.fromEntries(Object.entries(t).map(([a,s])=>[s,a]));this.lensOptions=e,this.mentionOptions=e,this.idToAtName=n},getSelectedLens(){let t=this.$store.search.lens_id||"";if(!t)return null;let e=this.idToAtName[t]||"";return{lensId:t,atName:e}},selectMention(){if(!this.controller||!this.mentionOpen||!this.mentionOptions.length)return;let t=this.controller.detectMention();if(!t)return;let e=this.mentionOptions[this.mentionIndex];e&&(this.controller.insertLensToken(t,e.lensId,e.atName),this.$store.search.lens_id=e.lensId,this.queryValue=this.controller.serialize(),this.mentionOpen=!1,this.mentionQuery="",this.mentionOptions=this.lensOptions,this.mentionIndex=0)},handleEditorKeydown(t){if(!this.mentionOpen){t.key==="Enter"&&(t.preventDefault(),this.submit());return}if(t.key==="ArrowDown"){t.preventDefault();let e=Math.max(this.mentionOptions.length-1,0);this.mentionIndex=Math.min(this.mentionIndex+1,e);return}if(t.key==="ArrowUp"){t.preventDefault(),this.mentionIndex=Math.max(this.mentionIndex-1,0);return}if(t.key==="Enter"||t.key===" "){t.preventDefault(),this.selectMention();return}t.key==="Escape"&&(t.preventDefault(),this.mentionOpen=!1,this.mentionQuery="",this.mentionOptions=this.lensOptions,this.mentionIndex=0)},async submit(){if(this.submitting)return;let t=this.$refs?.form;if(!t)throw new Error("Form ref not found");this.submitting=!0;try{let n=this.$refs?.lensSelect?.value?.trim()||this.$store.search.lens_id||"",a=this.queryValue.trim(),s=Number(this.$store.search.limit);if(!s||s<1)throw new Error("Invalid search limit");let i={q:a,exact:!!this.$store.search.exact,limit:s,lens_id:n||void 0},l=await fetch("/v1/search/fragment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok)throw new Error(`Search failed (HTTP ${l.status})`);let m=await l.text(),u=document.querySelector("#search-root");if(!u)throw new Error("Page missing #search-root element");u.outerHTML=m;let o=new URLSearchParams;i.q&&o.set("q",i.q),i.exact&&o.set("exact","true"),i.limit&&o.set("limit",String(i.limit)),i.lens_id&&o.set("lens_id",i.lens_id);let r=o.toString()?`${t.action}?${o.toString()}`:t.action;window.history.replaceState({},"",r)}catch(e){let n=e instanceof Error?e.message:String(e);this.showError(`Search failed: ${n}`)}finally{this.submitting=!1}}});var D=(t,e)=>({lensId:t,rawAtName:e,init(){if(!this.lensId||!this.rawAtName)throw new Error("lensId and rawAtName are required");this.render()},render(){let n=this.$el,a=C(this.rawAtName.toLowerCase());n.className="query-token",n.dataset.token="lens",n.dataset.lensId=this.lensId,n.dataset.atName=a,n.textContent=`@${a}`,n.setAttribute("contenteditable","false"),n.style.cursor="pointer"},removeLens(){this.$store.search.clearLens()}});var j=()=>({pending:!1,assistantEventSource:null,systemEventSource:null,createPlaceholder(t){let e=this.$refs.placeholderTemplate.content.cloneNode(!0),n=e.querySelector(".message");return n.dataset.tempId=t,e},parseHtmlElement(t){let e=document.createElement("template");return e.innerHTML=String(t).trim(),e.content.firstElementChild},cleanupEventStreams(){this.assistantEventSource&&this.assistantEventSource.close(),this.systemEventSource&&this.systemEventSource.close(),this.assistantEventSource=null,this.systemEventSource=null},cleanupAssistantStream(){this.assistantEventSource&&this.assistantEventSource.close(),this.assistantEventSource=null},cleanupSystemStream(){this.systemEventSource&&this.systemEventSource.close(),this.systemEventSource=null},startEventStreams(t,e,{afterAssistantUuid:n=null,afterSystemUuid:a=null}={}){if(this.assistantEventSource||this.systemEventSource)return;let s=new URL(`/v1/threads/${t}/events`,window.location.origin);s.searchParams.set("role","assistant"),n&&s.searchParams.set("after_uuid",n);let i=new URL(`/v1/threads/${t}/events`,window.location.origin);i.searchParams.set("role","system"),a&&i.searchParams.set("after_uuid",a),this.assistantEventSource=new EventSource(s),this.systemEventSource=new EventSource(i),this.assistantEventSource.addEventListener("assistant",async l=>{try{let u=JSON.parse(l?.data||"{}")?.uuid;if(!u)return;let o=await fetch(`/v1/messages/${u}/fragment`,{headers:{Accept:"text/html"}});if(!o.ok)return;let r=await o.text(),d=this.parseHtmlElement(r),h=this.$refs.responses.querySelector(`[data-temp-id="${e}"]`);h&&d&&h.replaceWith(d)}finally{this.cleanupEventStreams()}}),this.systemEventSource.addEventListener("system",async l=>{let m=JSON.parse(l?.data||"{}"),u=m?.uuid,o=m?.meta||{};if(u&&!(o?.object!=="job"||o?.status!=="failed"))try{let r=await fetch(`/v1/messages/${u}/fragment`,{headers:{Accept:"text/html"}});if(!r.ok)return;let d=await r.text(),h=this.parseHtmlElement(d),x=this.$refs.responses.querySelector(`[data-temp-id="${e}"]`);x&&h&&x.replaceWith(h)}finally{this.cleanupEventStreams()}}),this.assistantEventSource.addEventListener("error",()=>this.cleanupAssistantStream()),this.systemEventSource.addEventListener("error",()=>this.cleanupSystemStream())},init(){if(!this.$refs.responses||this.$refs.responses.children.length)return;let t=this.$el?.dataset?.threadId;if(!t)return;let e="initial",n=this.createPlaceholder(e);this.$refs.responses.prepend(n),this.startEventStreams(t,e)},async regenerate(t){if(this.pending)return;let e=t?.currentTarget,n=e?.dataset?.threadId,a=e?.dataset?.model,s=e?.dataset?.promptContent;if(!n||!s)return;this.pending=!0;let i=Math.random().toString(36).slice(2,10),l=this.createPlaceholder(i);this.$refs.responses.prepend(l);try{let u=this.$refs.responses.querySelector(".message[data-uuid]")?.dataset?.uuid||null,o=await fetch("/v1/ask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:s,thread_id:n,lens_id:this.$refs?.lensSelect?.value||void 0,model:a})});if(!o.ok)throw new Error(`Ask HTTP ${o.status}`);this.startEventStreams(n,i,{afterAssistantUuid:u})}catch(m){console.error("Error:",m);let u=this.$refs.responses.querySelector(`[data-temp-id="${i}"]`);u&&u.remove()}finally{this.pending=!1}}});document.addEventListener("alpine:init",()=>{if(!window.TRANSPORT?.search)throw new Error("TRANSPORT.search not found");Alpine.store("search",{...window.TRANSPORT.search,clearLens(){this.lens_id=""}}),Alpine.data("askButton",b),Alpine.data("responseMessage",M),Alpine.data("searchForm",B),Alpine.data("lensToken",D),Alpine.data("threadPage",j)});})();
