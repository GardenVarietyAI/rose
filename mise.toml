[tools]
python = "3.12"
rust = "1.88"
uv = "0.8.3"
dbmate = "2.22.0"
"ubi:benbjohnson/litestream" = "0.3.13"
sqlite = "3.50.4"

[tasks]
backup = "litestream replicate -config ./litestream.yml"
restore = "litestream restore -config ./litestream.yml -replica local -o ./data/rose.db ./data/rose.db"
dev-metal = "cd packages/rose-server && uv run maturin develop --features metal --release --target aarch64-apple-darwin"
dev = "cd packages/rose-server && uv run maturin develop --release"
build = "cd packages/rose-server && uv run maturin build --release"
test-metal = "uv run python -c 'from rose_server._inference import InferenceServer; s = InferenceServer(device=\"metal\"); print(\"Metal OK\")'"
test-cpu = "uv run python -c 'from rose_server._inference import InferenceServer; s = InferenceServer(device=\"cpu\"); print(\"CPU OK\")'"
migrate = "dbmate --no-dump-schema up"
[settings]
lockfile = true
